(function(){"use strict";var __webpack_modules__={1115:function(e,t,i){i.d(t,{Z:function(){return l}});var n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},o=[],s=i(1001),r={},a=(0,s.Z)(r,n,o,!1,null,null,null),l=a.exports},4087:function(e,t,i){i.d(t,{x:function(){return n}});i(3767),i(8585),i(8696);var n=function(e,t,i,n,o,s,r){this.chatType=e,this.msgType=t,this.sender=i,this.receiver=n,this.sessionKey=o,this.msg=s,this.clientSendTime=r};n.TEXT_MESSAGE=0,n.IMAGE_MESSAGE=1,n.CHAT_TYPE_1_2_1=0,n.CHAT_TYPE_1_2_N=1,n.CHAT_TYPE_CANCEL=2,n.CHAT_TYPE_LENGTH=1,n.MSG_TYPE_LENGTH=1,n.prototype.toBytes=function(){var e=parseInt(this.sender,10),t=e.toBytes(),i=t.length,o=null,s=null,r=null,a=4,l=null,c=4;this.chatType===n.CHAT_TYPE_1_2_N?(o=this.sessionKey.toArrayBuffer(),s=o.length,r=s.toBytes(),a=4):l=this.receiver.toBytes();var u=this.msgType===n.TEXT_MESSAGE?this.msg.toArrayBuffer():this.msg,d=this.msgType===n.TEXT_MESSAGE?u.length:this.msg.byteLength,h=d.toBytes(),p=4,f=(this.clientSendTime+"").toArrayBuffer(),g=f.length,m=0;m=this.chatType===n.CHAT_TYPE_1_2_N?n.CHAT_TYPE_LENGTH+n.MSG_TYPE_LENGTH+i+a+s+p+d+g:n.CHAT_TYPE_LENGTH+n.MSG_TYPE_LENGTH+i+c+p+d+g;let _=new Uint8Array(m);var v=0;return _.set([this.chatType,this.msgType],v),v+=n.CHAT_TYPE_LENGTH+n.MSG_TYPE_LENGTH,_.set(t,v),v+=i,this.chatType===n.CHAT_TYPE_1_2_N?(_.set(r,v),v+=a,_.set(o,v),v+=s):(_.set(l,v),v+=c),_.set(h,v),v+=p,_.set(u,v),v+=d,_.set(f,v),_},n.cancel=function(e,t,i){var n=0;console.log("撤销协议"),n+=1;const o=e.getInt32(n);n+=4;const s=t.slice(n,o+n);n+=o;const r=new Uint8Array(s).toString(),a=e.getInt32(n);n+=4;const l=t.slice(n,a+n),c=+new Uint8Array(l).toString();console.log(o,r,c),i({chatType:this.chatType,clientSendTime:c,sessionKey:r})},n.parse=async function(e,t){const i=await e.arrayBuffer();var o=0,s=new DataView(i),r=s.getUint8(o);if(2!==r){var a=null,l=null,c=null,u=null,d=null,h=null;o+=n.CHAT_TYPE_LENGTH;var p=s.getUint8(o);if(o+=n.MSG_TYPE_LENGTH,d=s.getInt32(o),o+=4,r===n.CHAT_TYPE_1_2_1&&(a=s.getInt32(o),l=n.generate121SessionKey(d,a),o+=4),r===n.CHAT_TYPE_1_2_N){var f=s.getInt32(o);o+=4;const e=i.slice(o,f+o);o+=f,l=new Uint8Array(e).toString()}var g=s.getInt32(o);if(o+=4,p===n.TEXT_MESSAGE){const e=i.slice(o,o+g),t=new Uint8Array(e);c=t.toString()}else u=i.slice(o,o+g);o+=g,h=new Uint8Array(i.slice(o,i.byteLength)).toString(),t({chatType:r,msgType:p,sender:d,receiver:a,msg:p===n.TEXT_MESSAGE?c:u,clientSendTime:parseInt(h,10),sessionKey:l})}else n.cancel(s,i,t)},n.getOppositeUser=function(e,t){if(Sparrow.isNullOrEmpty(e))return-1;var i=e.split("_");if(i.length<2)return-1;var n=parseInt(i[0],10),o=parseInt(i[1],10);return n===t?o:n},n.generate121SessionKey=function(e,t){return e<t?e+"_"+t:t+"_"+e}},9727:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{h:function(){return Sparrow}});var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7658),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_esnext_typed_array_to_reversed_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3767),core_js_modules_esnext_typed_array_to_reversed_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_esnext_typed_array_to_reversed_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_esnext_typed_array_to_sorted_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8585),core_js_modules_esnext_typed_array_to_sorted_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_esnext_typed_array_to_sorted_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_esnext_typed_array_with_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8696),core_js_modules_esnext_typed_array_with_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_esnext_typed_array_with_js__WEBPACK_IMPORTED_MODULE_3__);String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.json=function(){if(""===this||"''"===this||0===this.length)return null;-1!==this.indexOf("error|")&&console.log(this);try{var json=this;return json=json.decodeSplitKey(),eval("("+json.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>")+")")}catch(err){return console.log(err)}},String.prototype.firstCharToAscii=function(){return this.charCodeAt(0)},String.prototype.leftAlignWithChar=function(e,t){if(t=t||3,e=e||"0",!(this.length>=t)){for(var i=[],n=t-this.length,o=0;o<n;o++)i.push(e);return i.join("")+this}},String.prototype.getCountByChar=function(e){return this.split(e).length-1},String.prototype.getByteLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.subString=function(e,t){var i,n=0,o="",s=/[^\x00-\xff]/g,r="",a=this.replace(s,"**").length;for(i=0;i<a;i+=1){if(r=this.charAt(i).toString(),r.match(s)?n+=2:n+=1,n>e)break;o+=r}return t&&a>e&&(o+=".."),o},String.prototype.decodeSplitKey=function(){var e=this;return e=e.replace(/#colon#/g,":"),e=e.replace(/#dot#/g,","),e=e.replace(/#ref#/g,'\\"'),e=e.replace(/#limit/g,"#"),e},String.prototype.decodeHtml=function(){var e=this;return e=e.replace(/&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&nbsp;/g," "),e},String.prototype.format=function(){var e=this;if(arguments.length>=1&&"object"===typeof arguments[0]){var t=/#{(.*?)}/gi,i=null;while(i=t.exec(this)){var n=i[0],o=i[1],s=arguments[0].value(o);if(arguments.length>1)for(var r=1;r<arguments.length;r++)if(s=arguments[r].value(o),s)break;e=e.replace(n,$.isNullOrEmpty(s)?"-":s)}return e}var a=null;for(r=0;r<arguments.length;r++)a=new RegExp("\\{"+r+"\\}","gm"),e=e.replace(a,$.isNullOrEmpty(arguments[r])?"-":arguments[r]);return e},String.prototype.filterHTML=function(){var e=this;while(e.search(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi)>-1)e=e.replace(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi,"$2");return e.search(/<input.*>/)&&(e=e.replace(/<input.*>/gi,"")),e.search(/<(script).*?>.*?<\/\1>/)&&(e=e.replace(/<(script).*?>.*?<\/\1>/gi,"")),e.search(/<script.*>/)&&(e=e.replace(/<script.*>/gi,"")),e},String.prototype.firstCharUpperCase=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},String.prototype.join=function(e){return $.isNullOrEmpty(e)?this+"":this+e},String.prototype.toArrayBuffer=function(){var e,t,i=[];e=this.length;for(var n=0;n<e;n++)t=this.charCodeAt(n),t>=65536&&t<=1114111?(i.push(t>>18&7|240),i.push(t>>12&63|128),i.push(t>>6&63|128),i.push(63&t|128)):t>=2048&&t<=65535?(i.push(t>>12&15|224),i.push(t>>6&63|128),i.push(63&t|128)):t>=128&&t<=2047?(i.push(t>>6&31|192),i.push(63&t|128)):i.push(255&t);var o=new Int8Array(i.length);for(var n in i)o[n]=i[n];return o},Array.prototype.clear=function(){for(var e=0;e<this.length;e+=1)this.pop()},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},Array.prototype.toUint8Array=function(){for(var e=this,t=new Uint8Array(e.length),i=0;i<t.length;i++)t[i]=e[i];return t},Array.prototype.push||(Array.prototype.push=function(){for(var e=0;e<arguments.length;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.pop||(Array.prototype.pop=function(){return lastElement=this[this.length-1],this.length=Math.max(this.length-1,0),lastElement}),Uint8Array.prototype.toString=function(){for(var e=new DataView(this.buffer),t=new Uint8Array(this.buffer.byteLength),i=0;i<t.length;i++)t[i]=e.getUint8(i);var n="",o=t;for(i=0;i<o.length;i++){var s=o[i].toString(2),r=s.match(/^1+?(?=0)/);if(r&&8===s.length){for(var a=r[0].length,l=o[i].toString(2).slice(7-a),c=1;c<a;c++)l+=o[c+i].toString(2).slice(2);n+=String.fromCharCode(parseInt(l,2)),i+=a-1}else n+=String.fromCharCode(o[i])}return n},Number.prototype.toBytes=function(){length=4;var e=this,t=[],i=length;do{t[--i]=255&e,e>>=8}while(i);return t},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var Sparrow=function(e,t,i,n,o){if(window===this||!(this instanceof Sparrow)){var s=Array.prototype.slice.call(arguments,0);if(!e)return null;if("function"===typeof e)return e.apply(e,s.slice(1));if("jsonp"===s[0]){var r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.src=s[1],r.id=s[2];var a=document.getElementById(r.id);return null!=a&&document.head.removeChild(a),document.head.appendChild(r),null}if(o=e,"object"===typeof e&&(o="#"+e.id),t=null,i=document,n=!0,s.length>=2&&("boolean"==typeof s[1]?n=s[1]:t=s[1],s.length>=3&&("boolean"==typeof s[2]?n=s[2]:i=s[2]),4===s.length&&(n=s[3])),null!=t&&"object"===typeof t&&(t.id||(t.id="sparrow_"+$.random()),o+="_"+t.id),$.global(o))return $.global(o);var l=["#","!","$","&","*","+","^"];return"object"!==typeof e&&-1==l.indexOf(e.substring(0,1))?i.getElementById(e):new Sparrow(e,t,i,n,o)}var c=[];if(this.selector=e,this.doc=i,"object"===typeof e)c[0]=e,e.id||(e.id="sparrow_"+$.random()),this.selector="#"+e.id,o=this.selector;else if("string"===typeof e){var u=e.substring(0,1);e=e.substring(1);var d=e.split("."),h=0;switch(u){case"#":c[0]=i.getElementById(e);break;case"^":c=i.getElementsByTagName(e);break;case"&":c=i.getElementsByName(e);break;case"+":c[0]=i.createElement(d[0]),d.length>=2?c[0].id=d[1]:c[0].id="sparrow_"+$.random(),this.selector="#"+d[1],o=this.selector,d.length>=3&&("doc"===d[2]?this.doc.body.appendChild(c[0]):this.doc.getElementById(d[2]).appendChild(c[0])),d.length>=4&&(c[0].type=d[3]);break;case"!":
//!html-label.parentId"
var p=[];t||(t=$(d[1]));var f=t.getElementsByTagName(d[0]);for("li"===d[0]&&(t=f[0].parentNode),this.s=t,t.id||(t.id="sparrow_"+$.random()),h=0;h<f.length;h++)f[h].parentNode===t&&(p[p.length]=f[h]);c=p;break;case"$":var g=i.getElementsByTagName("label");for(h=0;h<g.length;h++)if(g[h].attributes["for"].value===e){c[0]=g[h];break}break;case"*":var m=[],_=i.getElementsByName(d[0]),v=null;for(d.length>1&&(v=d[1]),h=0;h<_.length;h++)_[h].checked&&(m[m.length]=v?_[h].attributes[v].value:_[h].value);c=m;break}}return e&&(this.length=0,c.length>0&&(this.s||(this.s=c[0]),this.s&&this.s.id&&n&&$.global(o,this)),[].push.apply(this,c)),this.interval=[],this};window.$=window.Sparrow=Sparrow,Sparrow.browser={url:{manage:"default.jsp",logout_url:"/user/logout.json"},cookie:{permission:"permission",call_back_url:"call_back_url",website_name:"website_name",themes:"sparrow.themes",root_domain:$((function(){return window.location.host.substr(window.location.host.indexOf(".")+1)})),domain:window.location.host},ie:$((function(){return-1!==navigator.userAgent.search(/MSIE/gim)})),opera:$((function(){return-1!==navigator.userAgent.search(/Opera/gim)})),firefox:$((function(){return-1!==navigator.userAgent.search(/Firefox/gim)})),google:$((function(){return-1!==navigator.userAgent.search(/Chrome/gim)})),version:$((function(){return-1!==navigator.userAgent.search(/MSIE/gim)?(navigator.userAgent.match(/MSIE\b\s*([0-9\.0-9]+);/gim),RegExp.$1):-1!==navigator.userAgent.search(/Opera/gim)?(navigator.userAgent.match(/Version\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Firefox/gim)?(navigator.userAgent.match(/Firefox\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Chrome/gim)?(navigator.userAgent.search(/Chrome\/([0-9\.]+)/gim),RegExp.$1):void 0})),addFavorite:function(e,t){document.all?window.external.AddFavorite(e,t):window.sidebar?window.sidebar.addPanel(t,e,""):alert("对不起，您的浏览器不支持此操作!\n请您使用菜单栏或Ctrl+D收藏本站。")},setHome:function(t,i){try{t.style.behavior="url(#default#homepage)",t.setHomePage(i)}catch(e){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var n=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);n.setCharPref("browser.startup.homepage",i)}catch(e){alert("抱歉！您的浏览器不支持直接设为首页。请在浏览器地址栏输入“about:config”并回车然后将[signed.applets.codebase_principal_support]设置为“true”，点击“加入收藏”后忽略安全提示，即可设置成功。")}}},copy:function(t,i){i||(i="成功复制！可以通过ctrl+v进行粘贴操作！");try{if(window.clipboardData)return window.clipboardData.setData("Text",t),void alert(i);try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(e){return alert("您的浏览器设置为不允许复制！\n如果需要此操作，请在浏览器地址栏输入'about:config'并回车\n然后将'signed.applets.codebase_principal_support'设置为'true',再重试复制操作!"),!1}var n=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!n)return;var o=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!o)return;o.addDataFlavor("text/unicode");var s=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);s.data=t,o.setTransferData("text/unicode",s,t.getByteLength());var r=Components.interfaces.nsIClipboard;if(!n)return!1;n.setData(o,null,r.kGlobalClipboard),alert(i)}catch(e){alert("对不起！您的浏览器不支持该功能")}},setCookie:function(e,t,i,n,o,s){var r=null;0!==i&&i&&(r=new Date,r.setTime(r.getTime()+1e3*i)),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(r?"; expires="+r.toGMTString():"")+"; path="+(o||"/")+"; domain="+(n||this.cookie.root_domain)+(s?"; secure":"")},getCookie:function(e){var t=null,i=document.cookie.indexOf(escape(e)+"=");if(-1!==i){var n=i+(escape(e)+"=").length,o=document.cookie.indexOf(";",n);t=-1!==o?decodeURIComponent(document.cookie.substring(n,o)):decodeURIComponent(document.cookie.substring(n))}return null==t||"undefined"===typeof t||"undefined"===t?null:t},showModalDialog:function(e,t,i,n,o){var s;i=$.randomUrl(i),s=$.browser.ie?window.showModalDialog(i,o,"dialogHeight:{0}px; dialogWidth:{1}px; status:no; help:no; scroll:auto".format(t,e)):window.open(i,o,"height={0}, width={1},toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(t,e)),s&&n(s)},window:function(e){var t=$.randomUrl(e.url);e.win||(e.win=window);var i=e.target?e.target:"_blank",n=null;$.isNullOrEmpty(e.width)&&(n="height={0}px,width={1}px,toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(e.height,e.width)),e.win.open(t,i,n)},close:function(){window.opener=null,window.open("about:blank","_self"),window.close()},getUrlWithoutParameter:function(e){var t=e||window.location.href,i=t.indexOf("?");return i<0&&(i=t.indexOf("#")),i>-1&&(t=t.substring(0,i)),t},getUserId:function(){var e=$.browser.getCookie(this.cookie.permission);return null==e?0:e.split("&")[0].substring(3)},getUserName:function(){var e=$.browser.getCookie(this.cookie.permission);return null==e?null:e.split("&")[1].substring(5)},isLogin:function(){var e=$.browser.getUserId();return!(null==e||0===e||"0"===e||"null"===e||""===e)},logout:function(e,t,i){$.isNullOrEmpty(t)&&(t=this.url.logout_url),$.isNullOrEmpty(i)&&(i=this.url.manage),$.ajax.json($.url.root+t,(function(t){var n=t.value;$.isNullOrEmpty(n)&&(n=$.browser.cookie.permission),$.browser.setCookie(n,"0",-1,e),$.url.root+"/"===window.parent.location.href||-1!==window.parent.location.href.indexOf(i)?window.parent.location.href=$.url.root:window.location.href=window.location.href}),!0)},getClientHeight:function(){return document.body.clientHeight&&document.documentElement.clientHeight?Math.min(document.body.clientHeight,document.documentElement.clientHeight):Math.max(document.body.clientHeight,document.documentElement.clientHeight)},getScrollHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},linkClick:function(e,t){return"boolean"===typeof e?!!e||($.alert(t,"sad"),!1):"javascript:void(0);"!==e.href||($.alert(t,"sad"),!1)}},Sparrow.container={},Sparrow.global=function(e,t){if("undefined"===typeof t)return this.container[e];this.container[e]=t},Sparrow.remove=function(e){delete this.container[e]},Sparrow.url={root:$((function(){})),_resource:function(e){var t=document.scripts,i=["/scripts/sparrow.js","/scripts/sparrow-min.js","/scripts-dev/sparrow.js"];if(e&&(i=[e]),null==t||0===t.length)return null;for(var n=null,o=0;o<t.length;o++){var s=!1;if(i.forEach((function(){for(var e=0;e<i.length;e++){var r=i[e],a=t[o].src.indexOf(r);a>-1&&(n=t[o].src.substring(0,a),s=!0)}})),s)break}return n},name:$.browser.cookie.domain.split(".")[0]},Sparrow.url.resource=$.url._resource(),Sparrow.url.passport=$((function(){return"http://passport."+$.browser.cookie.root_domain})),Sparrow.website={name:$.browser.getCookie($.browser.cookie.website_name),themes:$((function(){var e=$.browser.getCookie($.browser.cookie.themes);return null==e&&(e="themes_default"),e}))},Sparrow.css={menu:{frame:"background:#ffffff;position:absolute;z-index:1000;border:#ccc 1px solid;width:{0}px;height:auto;left:{1}px;top:{2}px;display:none",ul:"width:{0}px;height:auto;overflow:hidden;list-style:none;margin:0px;padding:0px;text-align:left",li:"width:{0}px;overflow:hidden;line-height:20px;margin:0px;border-bottom:#ccc 1px dotted;cursor:pointer;"}},Sparrow.SIDE="SIDE",Sparrow.HORIZONTAL="HORIZONTAL",Sparrow.VERTICAL="VERTICAL",Sparrow.DEFAULT_AVATOR_URL=$.url.resource+"/images/user.png",Sparrow.DEFAULT_RESOURCE_ICO_URL=$.url.resource+"/images/menu.png",Sparrow.indexedDB=function(e){this.support=window.indexedDB,this.instance=null,this.name=e.name,this.config=e,this.userId=localStorage.getItem("userId"),this.initSuccess=!1,this.$initDB=null},Sparrow.indexedDB.prototype={init:async function(){return this.support?(this.request=window.indexedDB.open(this.name+this.userId,this.config.version),await new Promise(((e,t)=>{this.request.onsuccess=async i=>{this.instance=i.target.result,console.log("数据库连接成功");var n=await this.flush();console.log("数据库flush结果",n),n?(this.initSuccess=!0,console.log("数据库flush成功"),this.$dbInit&&await this.$dbInit(),e(this.instance)):t("数据库连接失败")},this.request.onupgradeneeded=async t=>{console.log("首次创建数据库"),this.instance=t.target.result,this._initTables(),this.$dbInit&&await this.$dbInit(),this.initSuccess=!0,e(this.instance)},this.request.onerror=e=>{console.log("数据库发生错误",e),t("连接indexedDB出错")}}))):this.support},_createTable:function(e,t){this.instance.createObjectStore(e,{keyPath:t})},_initTables:function(){this.config.tableNames.forEach((e=>{this._createTable(e.name,e.key)}))},_getTableInstance:function(e){return this.instance.transaction(e,"readwrite").objectStore(e)},put:async function(e,t){return this.support?(this.initSuccess||await this.init(),await new Promise(((i,n)=>{const o=this._getTableInstance(e).put(t);o.onsuccess=n=>{console.log("put success: TABLE-NAME"+e+" item "+t),i(n.target.result)},o.fail=e=>{n(e.target.result)}}))):this.support},get:async function(e,t){return this.support?(this.initSuccess||await this.init(),await new Promise(((i,n)=>{console.log("GET tableName "+e+", get key:"+t);const o=this._getTableInstance(e).get(t);o.onsuccess=e=>{i(e.target.result)},o.fail=e=>{n(e.target.result)}}))):this.support},delete:async function(e,t){return this.support?(this.initSuccess||await this.init(),await new Promise(((i,n)=>{const o=this._getTableInstance(e).delete(t);o.onsuccess=()=>{console.log("delete success: TABLE-NAME"+e+" ,key "+t),i("tableName "+e+" ,key "+t)},o.fail=e=>{n(e)}}))):this.support},clear:async function(e){return this.support?await new Promise(((t,i)=>{const n=this._getTableInstance(e).clear();n.onsuccess=i=>{console.log("clear success: TABLE-NAME",e),t(i.target.result)},n.fail=e=>{i(e.target.result)}})):this.support},flush:async function(){if(!this.support)return this.support;for(var e=0;e<this.config.tableNames.length;e++){var t=this.config.tableNames[e].name;await this.clear(t).then((()=>{console.log("clear success: TABLE-NAME",t)})).catch((e=>{console.log(e)}))}return console.log("flush all table success"),!0},getAll:async function(e){return this.support?(this.initSuccess||await this.init(),await new Promise(((t,i)=>{const n=this._getTableInstance(e).getAll();n.onsuccess=i=>{console.log("getAll success: TABLE-NAME",e),t(i.target.result)},n.fail=e=>{i(e.target.result)}}))):this.support},getAllKeys:async function(e){return this.support?(this.initSuccess||await this.init(),await new Promise(((t,i)=>{const n=this._getTableInstance(e).getAllKeys();n.onsuccess=i=>{console.log("getAllKeys success: TABLE-NAME:",e+" ,keys:",i.target.result),t(i.target.result)},n.fail=e=>{i(e.target.result)}}))):this.support},count:async function(e){return this.support?(this.initSuccess||await this.init(),await new Promise(((t,i)=>{const n=this._getTableInstance(e).count();n.onsuccess=i=>{console.log("count success: TABLE-NAME",e),t(i.target.result)},n.fail=e=>{i(e.target.result)}}))):this.support},openCursor:async function(e){return this.support?(this.initSuccess||await this.init(),await new Promise(((t,i)=>{const n=this._getTableInstance(e).openCursor();n.onsuccess=i=>{console.log("openCursor success: TABLE-NAME.",e),t(i.target.result)},n.fail=e=>{i(e.target.result)}}))):this.support},openKeyCursor:async function(e){return this.support?(this.initSuccess||await this.init(),await new Promise(((t,i)=>{const n=this._getTableInstance(e).openKeyCursor();n.onsuccess=i=>{console.log("openKeyCursor success:TABLE-NAME",e),t(i.target.result)},n.fail=e=>{i(e.target.result)}}))):this.support}},Sparrow.ajax={tokenConfig:{},_objPool:[],referWindow:window,url:null,srcElement:null,SUCCESS:"0",_bindReadyStateChange:function(e,t){e.onreadystatechange=function(){if(4===e.readyState){if(200===e.status){if(-1!==e.responseText.indexOf('"login":false')){console.log("login false");var i=e.responseText.json();return document.domain=$.browser.cookie.root_domain,void(i.inFrame?window.parent.location.href=i.url:$.window(i))}if(-1!==e.responseText.indexOf("Access Denied"))return lang.message.accessDenied||(lang.message.accessDenied="Access Denied"),void $.alert(lang.message.accessDenied,"sad");if(t)return void t(e.responseText)}404!==e.status?500!==e.status?12031!==e.status?console.log(e.status+":未知错误"):console.log("服务器未启动"):console.log("服务器错误"):console.log("资源未找到")}}},_getInstance:function(){for(var e=0;e<this._objPool.length;e+=1)if(0===this._objPool[e].readyState||4===this._objPool[e].readyState)return this._objPool[e];return this._objPool[this._objPool.length]=this._createObj(),this._objPool[this._objPool.length-1]},_createObj:function(){var t=null;if(window.XMLHttpRequest)return t=new XMLHttpRequest,t.overrideMimeType&&t.overrideMimeType("text/xml"),t;if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}else console.log("浏览器不支持AJAX,请设置浏览器安全级别或更新浏览器");return t},_callback:function(e){var t=e.json();null!=t?t.code!==this.ajax.SUCCESS&&$.message(t.message):$.message("json parse error "+e)},gourl:function(e){this.ajax.referWindow.location.href=e},_findToken:function(e){var t=null;for(var i in this.tokenConfig)if(0===e.indexOf(i)){t=this.tokenConfig[i];break}return t},req:function(t,i,n,o,s){-1===i.indexOf("http://")&&(i=$.url.root+i);var r=this._getInstance();null!=r&&this._bindReadyStateChange(r,n),s&&(this.srcElement=s);try{r.open(t,i,!0),r.setRequestHeader("ajax","true"),r.setRequestHeader("pragma","no-cache"),r.setRequestHeader("cache-control","no-cache");var a=this._findToken(i);if(a)for(var l in a)r.setRequestHeader(l,a[l]());if("GET"===t)return void r.send(null);if("object"===typeof o)return r.setRequestHeader("Content-Type","application/json"),void r.send(JSON.stringify(o));if(!o)return void r.send();o=o.replace(/%/g,"%25"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.send(o)}catch(e){console.log(e)}},json:function(e,t,i,n,o){"function"===typeof t&&(i=t,t=null),$.ajax.req("POST",e,(function(e){var t=e.json();null!=t?t.code===$.ajax.SUCCESS&&i?i(t):$.message(t.message,$.ajax.srcElement):$.message("json parse error "+e)}),t,n,o)},get:function(e,t){t=t||$.ajax._callback,$.ajax.req("GET",e,t,null,null)},post:function(e,t,i){i=i||$.ajax._callback,$.ajax.req("POST",e,i,t,null)}},Sparrow.http={post:function(e,t,i){return new Promise(((n,o)=>{Sparrow.ajax.post(e,t,(function(e){var t=e.json();null!=t?n(t):o(e)}),i)}))},get:function(e,t){return new Promise(((t,i)=>{Sparrow.ajax.get(e,(function(e){var n=e.json();null!=n?t(n):i(e)}))}),t)}},Sparrow.v={background_color:"#fff",empty_string:"",index:null,right_message:'<img alt="" src="'+$.url.resource+"/images/"+$.website.themes+'/succeed.gif"/>',reset:function(){$.v.index=null},getErrorLabel:function(e){return e.errorCtrlId?$(e.errorCtrlId.join($.v.index)):null},initPlaceholder:function(e){for(var t in e){var i=e[t],n=$(t);null!=n&&"text"===n.type&&(n.placeholder=i.prompt)}},_setBackground:function(e,t,i){if(i&&!1!==$.v.background_color){t||(t=$.v.background_color);var n=e.parentLevel;if("undefined"==typeof n&&(n=1),n>0){var o=i;if(null==o)return;try{while("TR"!==o.tagName.toUpperCase()&&"line"!==o.className&&"validate"!==o.className)o=o.parentNode;o.style.background=t}catch(r){}var s=this.getErrorLabel(e);null!=s&&(s.className="front")}}},showMessage:function(e,t){e=e[t.id];var i=this.getErrorLabel(e);i&&(i.className="prompt",i.innerHTML=e.prompt),this._setBackground(e)},ok:function(e,t){var i=this.getErrorLabel(e);return i&&(i.innerHTML=this.right_message,i.className="prompt"),this._setBackground(e,"#ffffff",t),t&&(t.style.backgroundColor="#ffffff",""===t.value&&e.defaultValue&&(t.value=e.defaultValue)),!0},fail:function(e,t){t||(t=e.setError);var i=this.getErrorLabel(e);return i&&(i.innerHTML="!"+t,i.className="error"),"!"+t},_validate:function(e,t){this._setBackground(e,"#ffffff",t);var i=t.value.trim(),n=this.getErrorLabel(e),o="SELECT"===t.tagName.toUpperCase()&&!0===t.multiple?t.options.length:i.getByteLength();return 0===o&&e.allowNull?this.ok(e):0===o&&void 0!==e.defaultValue?(t.value=e.defaultValue,this.ok(e)):0!==o||e.allowNull?e.maxLength&&o>e.maxLength||e.minLength&&o<e.minLength?this.fail(e,e.lengthError):!n||"error"!==n.className||n.innerHTML!=="!"+e.setError||this.fail(e):this.fail(e,e.nullError)},isUserNameRule:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^[a-zA-Z0-9_]{6,20}$/)?this.fail(e,e.nameRuleError):this.ok(e,t)},isEmail:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/)?this.fail(e,e.emailError):this.ok(e,t)},isTel:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/)?this.fail(e,e.telError):this.ok(e,t)},isMobile:function(e,t){e=e[t.id],e.minLength=11,e.maxLength=11;var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^1[\d]{10}$/)?this.fail(e,e.mobileError):this.ok(e,t)},isIdCard:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^([1-9]([0-9]{16}|[0-9]{13})([0-9]|x|X))$/)?this.fail(e,e.idCardError):this.ok(e,t)},isNull:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:this.ok(e,t)},isChineseCharacters:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:e.allowNull||-1!==t.value.search(/^[\u4e00-\u9fa5]+/)?this.ok(e,t):this.fail(e,e.chineseCharactersError)},isEqual:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:t.value!==$(e.otherCtrlId.join($.v.index)).value.trim()?this.fail(e,e.noEqualError):this.ok(e,t)},allowInputOption:function(e,t){e=e[t.id],e.defaultValue||(e.defaultValue=e.options[0]);for(var i=0;i<e.options.length;i++)if(t.value==e.options[i])break;i==e.options.length&&(t.value=e.defaultValue),this.ok(e,t)},isDigital:function(e,t){e=e[t.id];var i=t.value,n=this._validate(e,t);if(!0!==n)return n;if(isNaN(i))return this.fail(e,e.digitalError);var o=parseFloat(i),s=e.minValue||0===e.minValue,r=e.maxValue||0===e.maxValue;if(s&&o<e.minValue||r&&o>e.maxValue)return this.fail(e,e.digitalError);this.ok(e,t)},isImgSize:function(e,t){var i=e.value.split("*");2===i.length&&-1!==i[0].search(/^[0-9]+.?[0-9]$/)&&-1!==i[1].search(/^[0-9]+.?[0-9]$/)||(e.value=t)},isFileLength:function(e,t){-1===e.value.toUpperCase().indexOf("M")?-1===e.value.toUpperCase().indexOf("K")?e.value=t:-1!==e.value.toUpperCase().split("K")[0].search(/^[0-9]+.?[0-9]$/)?e.value=e.value.toUpperCase().split("K")[0]+"KB":e.value=t:-1!==e.value.toUpperCase().split("M")[0].search(/^[0-9]+.?[0-9]$/)?e.value=e.value.toUpperCase().split("M")[0]+"MB":e.value=t},updateTxtCount:function(e,t,i,n){var o=$(t);if(n=n||window.event,n.keyCode<37||n.keyCode>40){var s=e.value.getByteLength(),r=i-s;r<=0?(o.innerHTML=0,e.value=e.value.subString(i,!1)):o.innerHTML=r}},getValidateResult:function(e,t){var i=[];for(var n in e){var o=e[n];if(o&&"object"===typeof o){var s=null,r=$(n);if(r){var a=this.getErrorLabel(o);a&&"error"===a.className&&(s=a.innerHTML),$.isNullOrEmpty(s)&&(s=$.v.isNull(e,r)),$.v.validate&&(s=$.v.validate()),!0===s||$.isNullOrEmpty(s)||i.push(s)}}}if(i.length>0)return $.message(i.join("<br/>")),!1;if(!1!==t)if("string"===typeof t||"undefined"===typeof t)$.submit(t);else if("function"===typeof t)t(this);else if("object"===typeof t&&"hidden"===t.s.type){var l=t.attr("new");$.isNullOrEmpty(t.value())||(l=t.attr("update")),$.submit(l)}return!0},init:function(e){for(var t in e){var i=$("#"+t),n=e[t],o=n.event;switch(i.bind("onfocus",(function(){$.v.showMessage(e,this)})),o){case"UserNameRuleValidator":i.bind("onblur",(function(){$.v.isUserNameRule(e,this)}));break;case"AllowOptionsValidator":i.bind("onblur",(function(){$.v.isNull(e,this)}));break;case"DigitalValidator":i.bind("onblur",(function(){$.v.isDigital(e,this)}));break;case"EmailValidator":i.bind("onblur",(function(){$.v.isEmail(e,this)}));break;case"NullValidator":i.bind("onblur",(function(){$.v.isNull(e,this)}));break;case"EqualValidator":i.bind("onblur",(function(){$.v.isEqual(e,this)}));break;case"IdCardValidator":i.bind("onblur",(function(){$.v.isIdCard(e,this)}));break;case"MobileValidator":i.bind("onblur",(function(){$.v.isMobile(e,this)}));break;case"TelValidator":i.bind("onblur",(function(){$.v.isTel(e,this)}));break;case"ChineseCharactersValidator":i.bind("onblur",(function(){$.v.isChineseCharacters(e,this)}));break;case"AllowInputCharLengthValidator":var s=n;$("#"+s.maxCharLengthControlId).html(s.maxAllowCharLength),i.bind("onblur",(function(){$.v.allowInputOption(e,this)})),i.bind("onkeyup",(function(){$.v.updateTxtCount(this,s.allowCharLengthShowControlId,500)}))}}}},Sparrow.page={toTargetPage:function(e,t,i){var n=parseInt($("consumerPageIndex").value),o=parseInt($("spanCurrentPageIndex").innerHTML.trim());n<=0||n>e?$.message("超出页码范围",i):n!==o?window.location.href=t.replace("$pageIndex",n):$.message("当前页即是目标页",i)},consumerAction:null,submit:function(e,t){$("currentPageIndex").value=e,window.location.href="#top",null==this.consumerAction?$.submit(null,t):this.consumerAction(e)},next:function(){for(var e=$("divPage").getElementsByTagName("a"),t=null,i=0;i<e.length;i++)if("下一页"===e[i].innerHTML){t=e[i].href;break}$.isNullOrEmpty(t)?alert("亲，您已经翻到最后了哟"):window.location.href=t}},Sparrow.random=function(){return(Math.random()+"").substring(2)},Sparrow.randomUrl=function(e){return-1!==e.indexOf("t=")&&(e=e.substr(0,e.indexOf("t=")-1)),-1!==e.indexOf("?")?e+="&t="+Math.random():e+="?t="+Math.random(),e},Sparrow.request=function(e){var t=new RegExp("(^|\\?|&)"+e+"=([^&]*)(\\s|&|$)","i");return t.test(location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""},Sparrow.isNullOrEmpty=function(e){return null==e||"undefined"===typeof e||"string"===typeof e&&(""===e.trim()||"null"===e.trim())},Sparrow.toString=function(e,t){return t||(t=""),$.isNullOrEmpty(e)?t:e},Sparrow.countDown=function(e,t,i){var n=e-t,o=Math.floor(n/1e3/60/60/24),s=Math.floor(n/1e3/60/60%24),r=Math.floor(n/1e3/60%60),a=Math.floor(n/1e3%60);i.value=(o>0?o+"天":"")+(s>0?s+"时":"")+(r>0?r+"分":"")+(a<0?0:a)+"秒";var l=arguments.callee;(o>0||s>0||r>0||a>0)&&setTimeout((function(){l(e,t+1e3,i)}),1e3)},Sparrow.getBeforeTime=function(e){e=new Date(e).valueOf();var t=(new Date).valueOf(),i=[{name:"秒",split:60},{name:"分钟",split:60},{name:"小时",split:24},{name:"天",split:30},{name:"月",split:12},{name:"年",split:100}];return $((function(e,t){return e/i[t].split<1?(parseInt(e)<0?1:parseInt(e))+i[t].name:arguments.callee(e/i[t].split,++t)}),(t-e)/1e3,0)},Sparrow.submit=function(e,t){t=t||0,e&&(document.forms[t].action=e),document.forms[t].submit()},Sparrow.jsonKeys=function(e){var t=[];if(!e)return t;if("undefined"===typeof e.length){for(var i in e)t.push(i);return t}return e},Sparrow.clearForm=function(e){for(var t=$.jsonKeys(e),i=0;i<t.length;i++){var n=$(t[i]);if(null!=n){var o="";e[t[i]]&&(o=e[t[i]].defaultValue),n.value=$.toString("",o)}else console.log(t[i]+" not exist!")}},Sparrow.getFormData=function(e){for(var t=[],i=$.jsonKeys(e),n=0;n<i.length;n++){var o=$(i[n]);if(null!=o){if(!$.isNullOrEmpty(o.name)){var s=o.value;t.push(o.name+"="+s)}}else console.log(i[n]+" not exist!")}return t.join("&")},Sparrow.waitRedirect=function(e,t){var i=$("#hdnQueryString").value(),n=$("#"+e);if(null!=n&&null!=n.s){t||(t=1e3);var o=window.setInterval((function(){var e=parseInt(n.html(),10);0===e--?(window.location.target="_self",window.location.href=i,window.clearInterval(o)):n.html(e)}),t)}},Sparrow.format=function(txt,compress){var indentChar="    ";if("string"!==typeof txt||!/^\s*$/.test(txt)){var data=null;if("object"===typeof txt)data=txt;else try{data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function(e,t,i,n,o){nodeCount++;for(var s=0,r="";s<n;s++)r+=indentChar;if(r=compress?"":r,maxDepth=++n,t&&t.constructor===Array){draw.push(r+(o?'"'+e+'":':"")+"["+line);for(s=0;s<t.length;s++)notify(s,t[s],s===t.length-1,n,!1);draw.push(r+"]"+(i?line:","+line))}else if(t&&"object"===typeof t){draw.push(r+(o?'"'+e+'":':"")+"{"+line);var a=0;s=0;for(var l in t)a++;for(var l in t)notify(l,t[l],++s===a,n,!0);draw.push(r+"}"+(i?line:","+line))}else"string"===typeof t&&(t='"'+t+'"'),draw.push(r+(o?'"'+e+'":':"")+t+(i?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}alert("数据为空,无法格式化! ")},Sparrow.bind=function(e,t,i){return function(n){if(t.indexOf("|")>-1)for(var o=t.split("|"),s=0;s<o.length;s++)i?e[o[s]](i,n):e[o[s]](n);else i?e[t](i,n):e[t](n)}},Sparrow.prototype.each=function(e){for(var t=0,i=this.length;t<i;t++)e.call(this[t],t,this)},Sparrow.prototype.attr=function(e,t){if(this.s){if($.isNullOrEmpty(t)){var i=this.s.attributes[e];return i?i.value:this.s.getAttribute(e)}this.s.setAttribute(e,t)}},Sparrow.prototype.html=function(e){if(this.s){if($.isNullOrEmpty(e))return this.s.innerHTML;this.s.innerHTML=e}},Sparrow.prototype.format=function(e,t){this.s&&(null!=$(e)&&(e=$("#"+e).html()),this.s.innerHTML=e.format(t))},Sparrow.prototype.value=function(e){if(this.s)return void 0===e||null===e?this.s.value:void(this.s.value=e)},Sparrow.prototype.check=function(e){for(var t=0;t<this.length;t++)if(this[t].value===e){this[t].checked="checked";break}},Sparrow.prototype.opacity=function(e){if(e>=0)return this.s.style.filter="alpha(opacity="+e+")",this.s.style.opacity=e/100,void this.s.setAttribute("opacity",e);var t=this.s.attributes["opacity"];return t?t.value:100},Sparrow.prototype.bind=function(e,t){this.s&&(this.s.attachEvent?this.s.attachEvent(e,t):this.s.addEventListener(e.substring(2),t,!1))},Sparrow.prototype.getAbsoluteTop=function(){var e=this.s,t="string"===typeof e?$(e):e,i=t.offsetTop;while(null!=(t=t.offsetParent))i+=t.offsetTop;return i},Sparrow.prototype.getAbsoluteLeft=function(){var e=this.s,t="string"===typeof e?$(e):e,i=t.offsetLeft;while(null!=(t=t.offsetParent))i+=t.offsetLeft;return i},Sparrow.prototype.source=function(){return this.s},Sparrow.prototype.class=function(e){if(!e)return this.s.className;this.s.className=e},Sparrow.prototype.css=function(attribute,value,add){if(Math.abs(value)<1&&(value=value<0?-1:1),"opacity"===attribute)value=Math.ceil(value),add&&(value=parseInt(this.opacity(),10)+value),this.opacity(value);else{var command=null;add?(command='var o=parseInt($("'+this.s.id+'").style.'+attribute+",10);",command+='$("'+this.s.id+'").style.'+attribute+"=(o+"+value+')+"px";'):command='$("'+this.s.id+'").style.'+attribute+'="'+value+'"',eval(command)}return this},Sparrow.prototype.change_check_box_class=function(e,t,i,n){var o=this.s.className;n||(n="_");var s=o.split(n);return i||(i="check"),t||(t=s.length),e?o.indexOf(i)<0&&(s.splice(t,0,i),this.s.className=s.join(n)):o.indexOf(i)>=0&&(s.splice(t,1),this.s.className=s.join(n)),s.splice(t,s.length-t+1),s.join(class_split)},Sparrow.prototype.contains=function(e){while(null!=e&&"undefined"!==typeof e.tagName){if(e===this.s)return!0;e=e.parentNode}return!1},Sparrow.prototype.remove=function(){null!=this&&null!=this.s&&(this.doc.body.removeChild(this.s),this.s=null)},Sparrow.prototype.fix=function(e,t){if(this.s){var i=this.s.offsetWidth;t||(t=this.getAbsoluteLeft()),$.browser.ie&&"6.0"===$.browser.version?(this.doc.documentElement.style.backgroundImage="url(about:blank)",this.doc.documentElement.style.backgroundAttachment="fixed",this.doc.body.style.backgroundImage="url(about:blank)",this.doc.body.style.backgroundAttachment="fixed",this.s.style.position="absolute"):this.s.style.position="fixed",this.s.style.top=e+"px",this.s.style.left=t+"px",this.s.style.width=i+"px"}},Sparrow.prototype.center=function(){if(this.s){var e=(this.doc.body.clientWidth-this.s.offsetWidth)/2,t=this.doc.documentElement.clientHeight>screen.availHeight?screen.availHeight:this.doc.documentElement.clientHeight,i=t-161,n=64+parseInt((i-this.s.offsetHeight)/2);this.fix(n,e)}},Sparrow.prototype.loadComplete=function(e){if("IFRAME"===this.s.tagName.toUpperCase())this.s.onload=function(){e(this)};else if("IMG"===this.s.tagName.toUppperCase()){if($.browser.ie)return void(this.s.onreadystatechange=function(){"complete"!==this.s.readyState&&"loaded"!==this.s.readyState||e(this)});this.s.onload=function(){!0===this.s.complete&&e(this)}}},Sparrow.prototype.parent=function(){return $(this.s.parentNode)},Sparrow.prototype.fresh=function(e){$.isNullOrEmpty(this.s.src)&&(this.s.src=e),this.s.src=$.randomUrl(this.s.src)},Sparrow.prototype.enter=function(e){this.s.onkeydown=function(t){t=window.event||t,13===t.keyCode&&("string"!==typeof e?e():$(e).onclick(t))}};var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?11daae2d559a82e0e8bd4872ad217164";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})(),Sparrow.gridView={keyType:"int",id:"grvManageList",resultCtrlId:"hdnGridResult",getTable:function(){return $(this.id)},init:function(){var e=$("#"+this.resultCtrlId);null!=e&&($.isNullOrEmpty(e.attr("gridViewId"))||(this.id=e.attr("gridViewId")),$.isNullOrEmpty(e.attr("keyType"))||(this.keyType=e.attr("keyType")))},getCellIndex:function(e){return e.parentNode.cellIndex},allCheckClick:function(e){for(var t=$("&"+this.id),i=0;i<t.length;i+=1){var n=t[i];n.checked=e.checked}},recordCheckClick:function(e,t){if(!1!==e.checked){for(var i=!0,n=$("&"+this.id),o=0;o<n.length;o++)!1===n[o].checked&&(i=!1);i&&($(t).checked=!0)}else $(t).checked=!1},mustSelect:function(e){for(var t=[],i=$("&"+this.id),n=null,o=0;o<i.length;o+=1){var s=i[o];"input"===s.tagName.toLowerCase()&&s.checked&&(n=s.id,"string"===this.keyType?t.push("'"+n+"'"):t.push(n))}return 0===t.length?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define 'lang.message.noSelectRecord'!"),!1):(1===t.length&&(t.pop(),t.push(n)),e?!!window.confirm(e)&&t:t)},onlyCheckedOne:function(e){for(var t=0,i=null,n=$("name."+this.id),o=1;o<n.length;o++){var s=n[o];s.checked&&(t+=1,i=s.id)}return 0===t?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define lang.message.noSelectRecord!"),!1):1!==t?(lang.message.onlySelectOneRecord?$.message(lang.message.onlySelectOneRecord):$.message("please define lang.message.onlySelectOneRecord"),!1):!window.confirm(e)||i},submit:function(e,t,i){var n=i?this.onlyCheckedOne(t):this.mustSelect(t);if(n){if($(this.resultCtrlId).value=n,"return"===e)return!0;$.submit(e)}}},Sparrow.table=function(e){if(!(this instanceof Sparrow.table))return new Sparrow.table(src);e&&(this.id=e,this.t=$(e),this.body=t.getElementsByTagName("tbody")[0],this.tr=[])},Sparrow.table.prototype={_initCell:function(e,t,i){e.style.cssText=this.tr[t].td[i].cssText,e.className=this.tr[t].td[i].className,e.align=this.tr[t].td[i].align,e.innerHTML=this.tr[t].td[i].innerHTML,this.tr[t].td[i].colspan&&e.setAttribute("colspan",this.tr[t].td[i].colspan)},_initRow:function(e,t){e.style.cssText=table.tr[t].cssText,table.tr[t].className&&""!==table.tr[t].className&&(e.className=table.tr[t].className);for(var i=0;i<this.tr[t].td.length;i++){var n=e.insertCell(-1);this._initCell(n,t,i)}},init:function(){for(var e=0;e<this.tr.length;e++)this.body.appendChild(this._initRow(e));$(this.containerId).appendChild(this.t)},appendRow:function(){for(var e=0;e<this.tr.length;e++){var t=this.body.insertRow(-1);this._initRow(t,e)}},insertRow:function(e){for(var t=0;t<this.tr.length;t++){var i=this.body.insertRow(e);this._initRow(i,t)}},updateRow:function(e){for(var t=0;t<this.tr[0].td.length;t++)this.tr[0].td[t].innerHTML&&(this.body.rows[e].cells[t].innerHTML=this.tr[0].td[t].innerHTML)},removeRow:function(e){this.body.deleteRow(e)}},Sparrow.file={isShowProgress:!0,wit:null,clientFileName:null,uploadFrameId:null,uploadCallBack:function(e,t,i){console.info(e),console.info(i),this.clearStatus()},clearStatus:function(){window.clearInterval(this.wit),window.setTimeout((function(){var e=$("divStatus");$.file.isShowProgress&&null!=e&&document.body.removeChild(e)}),1e3)},fileSerialNumber:null,validateUploadFile:function(e,t,i){$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png"],"errorImgForumIco")&&$.file.uploadDelegate(t,i)},callbackValidate:function(e){return!!$.isNullOrEmpty(e.error)||($.alert(e.error,"sad"),$.file.clearStatus(),!1)},reset:function(){var e=$(this.uploadFrameId),t=e.src;e.src="about:blank",e.src=t},getUploadFrame:function(){return this.uploadFrameId?$(this.uploadFrameId):$("fileUpload")},getUploadFile:function(e){return e||(e=this.getUploadFrame()),e.contentWindow.document.getElementById("file_upload")},getUploadFileInfo:function(e){return e||(e=this.getUploadFrame()),e.contentWindow.document.getElementById("fileInfo")},getFileSerialNumber:function(){return this.fileSerialNumber},setFileSerialNumber:function(e){this.fileSerialNumber=e},getFullPath:function(e){if(!e)return"";if($.browser.ie){e.select();var t=document.frames[0].document.selection.createRange().text;return document.frames[0].document.selection.empty(),t}return $.browser.firefox&&e.files?e.files.item(0).getAsDataURL():e.value},getExtension:function(e){return e=$.browser.getUrlWithoutParameter(e),e.substring(e.lastIndexOf(".")).toLocaleLowerCase()},getFileName:function(e){return e=$.browser.getUrlWithoutParameter(e),-1!==e.indexOf("\\")?e.substring(e.lastIndexOf("\\")+1):-1!==e.indexOf("/")?e.substring(e.lastIndexOf("/")+1):e},checkFileType:function(e,t,i){for(var n=this.getExtension(e),o=!1,s=0;s<t.length;s+=1)if(t[s].toLocaleLowerCase()===n||"."+t[s].toLocaleLowerCase()===n){o=!0;break}if(o)return $.v.ok(i),o;var r=$("#"+i);return null!=r&&null!=r.source()&&(r.class("error"),r.html("!只支持:"+t+"格式")),$.message("文件格式不正确，只支持以下格式:\n"+t),o},uploadDelegate:function(e,t,i){if(!1!==this.isShowProgress&&$("divStatus"))return $.alert(this.clientFileName+"正在上传中,请稍侯...","sad"),!1;this.uploadFrameId=(t?t.obj:"null")+"."+e;var n=this.getUploadFrame();if(this.clientFileName=this.getUploadFile(n).value,""===this.clientFileName)return $.message("请选择上传文件!",i),!1;var o=this.getUploadFileInfo(n).value,s=o.split(".");if(this.setFileSerialNumber(s[2]),!1!==$.file.isShowProgress){if(!$("divStatus")){var r=$(n),a=$("+div");a.s.id="divStatus",a.s.style.cssText="width:260px;height:100px;position:absolute;color:#ffffff;background:#000000;font-size:10pt;border:#ccc 1px solid;text-align:left;",a.html("服务器正在加载文件信息..."),document.body.appendChild(a.s),a.s.style.top=r.getAbsoluteTop()-10+"px",a.s.style.left=r.getAbsoluteLeft()+"px",a.opacity(90)}this.wit=window.setInterval((function(){$.file.getStatus()}),1e3)}n.contentWindow.document.forms[0].submit()},progressCallback:function(e){if(null!=e&&"loading"!==e.status&&this.callbackValidate(e)){var t=[],i=Math.ceil(parseFloat(e.readLength)/parseFloat(e.contentLength)*1e6)/1e4+"%";t.push("正在上传文件<br/><span class='highlight'>《"+$.file.getFileName($.file.clientFileName)+"》</span><br/>"),t.push("文件大小:"+e.humanReadableContentLength+"<br/>"),t.push("上传大小:"+e.humanReadableReadLength+"<br/>"),t.push("上传进度:"+i),$("#divStatus",!1).html(t.toString()),"100%"===i&&$.file.clearStatus()}},getStatus:function(){$("jsonp",$.url.upload+"/file-upload?file-serial-number="+this.getFileSerialNumber()+"&t="+Math.random()+"&callback=progressCallback","uploadProgress")},initImageUploadEvent:function(e,t){$.url.upload||(console.error("please config $.url.upload the default config is $.url.root ["+$.url.root+"]"),$.url.upload=$.url.root);var i=$("null."+e);null!=i&&(document.domain=$.browser.cookie.root_domain,t||(t="Cover"),i.src=$.url.upload+"/file-upload?path-key="+e+"&t="+Math.random(),$.file.uploadCallBack=function(e,t,i){console.info(i)},$.file.validateUploadFile=function(e,i,n){var o=t;"object"===typeof t&&(o=t[i]),$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png"],"error"+o)&&($.file.uploadCallBack=function(e){if($.file.clearStatus(),e.fileUrl){var t=$("#div"+o);null!=t&&t.html("<a href='"+e.fileUrl+"' target='_blank'><img src='"+e.fileUrl+"'/></a>");var i=$("#hdn"+o);null!=i&&i.value(e.fileUrl);var n=$("#error"+o);null!=n&&null!=n.s&&(n.class("prompt"),n.html(""))}},$.file.uploadDelegate(i,n))})}},Sparrow.event=function(e){if(!(this instanceof Sparrow.event))return new Sparrow.event(e);e&&(this.originalEvent=e,this.type=e.type,this.e=window.event||this.originalEvent,this.srcElement=this.e.srcElement||this.e.target,this.toElement=this.e.toElement||this.e.relatedTarget)},Sparrow.event.prototype={dragapproved:!1,srcElement:null,eventX:null,eventY:null,srcLeftPos:null,srcRightPos:null,cancelBubble:function(){window.event?window.event.cancelBubble=!0:this.e.stopPropagation()},preventDefault:function(){this.e.preventDefault&&this.e.preventDefault(),window.event&&(window.event.returnValue=!1)},getAbsoluteTop:function(){return this.e.pageY?this.e.pageY:this.e.clientY?this.e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},getAbsoluteLeft:function(){return this.e.pageX?this.e.pageX:this.e.clientX?this.e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},move:function(){return!this.dragapproved||null==this.srcElement||(this.srcElement.style.left=this.srcLeftPos+this.clientX-this.eventX,void(this.srcElement.style.top=this.srcRightPos+this.clientY-this.eventY))},move_end:function(){this.dragapproved=!1,this.srcElement.onmousemove=null},drags:function(){try{if(-1!==this.srcElement.className.indexOf("drag")){"drag-p"===this.srcElement.className?this.srcElement=this.srcElement.parentNode:"drag-pp"===this.srcElement.className?this.srcElement=this.srcElement.parentNode.parentNode:this.srcElement=null;var t=$(this.srcElement);this.dragapproved=!0,this.srcLeftPos=t.getAbsoluteLeft(),this.srcRightPos=t.getAbsoluteTop(),this.eventX=e.clientX,this.eventY=e.clientY,this.srcElement.onmousemove=this.move}else this.srcElement=null,this.dragapproved=!1,this.srcElement.onmousemove=null}catch(i){}}},Sparrow.prototype.progressbar=function(e,t){var i=$("+div");document.body.appendChild(i.s),t.style&&(i.s.style.cssText=t.style);var n=$("+div");i.s.appendChild(n.s),t.progressStyle&&(n.s.style.cssText=t.progressStyle),n.s.style.width="0px",n.it=window.setInterval((function(){e(n)}),100),n.end=function(){window.clearInterval(n.it)},n.remove=function(){document.body.removeChild(n.s.parentNode)}},Sparrow.treeNode=function(e,t,i,n,o,s,r,a,l,c){this.id=e,this.pid=t,this.name=i,this.url=n,this.title=o,this.target=s,this.showCtrl=a||!0,this.businessEntity=l,this.childCount=r||0,this.icon=c,this.iconOpen=c,this._isOpened=!1,this._isSelected=!1,this._lastOfSameLevel=!1,this._addressIndex=0,this._parentNode,this._hasChild=r>0},Sparrow.tree=function(e,t){this.config={target:"_self",useFolderLinks:!0,useSelection:!0,useCookies:!0,useLines:!0,useIcons:!0,useRootIcon:!0,usePlusMinusIcons:!0,useTreeIdInNodeClass:!1,useLevelInNodeClass:!1,useRadio:!1,useCheckbox:!1,treeNodeClass:null,reBuildTree:null,loadFloatTree:null,floatTreeId:null,descHiddenId:null,descTextBoxId:null,validate:null,validateConfig:null,isdelay:!1,isclientDelay:!1,closeSameLevel:!1,inOrder:!1,showRootIco:!0,showOrder:!1,orderURL:null,treeFrameId:null,loadingString:"londing .....",imageDir:$.url.resource+"/images/treeimg",RESOURCE_TYPE:{1:"[系统菜单]",2:"[系统页面]",3:"[控件事件]"}},this.icon={root:this.config.imageDir+"/base.gif",folder:this.config.imageDir+"/folder.gif",folderOpen:this.config.imageDir+"/folderopen.gif",node:this.config.imageDir+"/page.gif",nolineNode:this.config.imageDir+"/nolinepage.gif",empty:this.config.imageDir+"/empty.gif",line:this.config.imageDir+"/line.gif",join:this.config.imageDir+"/join.gif",joinBottom:this.config.imageDir+"/joinbottom.gif",plus:this.config.imageDir+"/plus.gif",plusBottom:this.config.imageDir+"/plusbottom.gif",minus:this.config.imageDir+"/minus.gif",minusBottom:this.config.imageDir+"/minusbottom.gif",nlPlus:this.config.imageDir+"/nolines_plus.gif",nlMinus:this.config.imageDir+"/nolines_minus.gif"},this.interval=null,this.currentSelectId={},this.floatTreeFrameId=null,this.obj=e,this.parentName=t,this.fullObjName=t?t+"."+e:e,this.aNodes=[],this.aIndent=[],this.root=new Sparrow.treeNode(-1),this.selectedNodeIndex=null,this.selectedFound=!1,this.completed=!1},Sparrow.tree.prototype={resetIcon:function(){this.icon.root=this.config.imageDir+"/base.gif",this.icon.nolineroot=this.config.imageDir+"/nolinebase.gif",this.icon.folder=this.config.imageDir+"/folder.gif",this.icon.folderOpen=this.config.imageDir+"/folderopen.gif",this.icon.node=this.config.imageDir+"/page.gif",this.icon.nolineNode=this.config.imageDir+"/nolinepage.gif",this.icon.empty=this.config.imageDir+"/empty.gif",this.icon.line=this.config.imageDir+"/line.gif",this.icon.join=this.config.imageDir+"/join.gif",this.icon.joinBottom=this.config.imageDir+"/joinbottom.gif",this.icon.plus=this.config.imageDir+"/plus.gif",this.icon.plusBottom=this.config.imageDir+"/plusbottom.gif",this.icon.minus=this.config.imageDir+"/minus.gif",this.icon.minusBottom=this.config.imageDir+"/minusbottom.gif",this.icon.nlPlus=this.config.imageDir+"/nolines_plus.gif",this.icon.nlMinus=this.config.imageDir+"/nolines_minus.gif"},addBusinessEntity:function(e,t,i,n,o,s){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(e,t,i,n,o,"_self",void 0,!0,s)},add:function(e,t,i,n,o,s,r,a,l,c){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(e,t,i,n,o,s,r,a,l,c)},openAll:function(){this.oAll(!0)},closeAll:function(){this.oAll(!1)},toString:function(){var e='<div class="sparrow-tree">';return document.getElementById?(this.config.useCookies&&(this.selectedNodeIndex=this.getSelectedAi()),e+=this.addNode(this.root)):e+="Browser not supported.</div>",this.selectedFound||(this.selectedNodeIndex=null),this.completed=!0,e},deleteClick:function(){alert("deleteClick not defined!")},removeNode:function(e){e||(e=this.aNodes[this.getSelectedAi()]),this.aNodes.splice(e._addressIndex,1),this.clearSelectedNode(),$(this.config.treeFrameId).innerHTML=this.toString(),this.clearFloatFrame()},appendNode:function(e){this.aNodes.push(e),$(this.config.treeFrameId).innerHTML=this.toString()},updateNode:function(e,t){t||(t=this.aNodes[this.getSelectedAi()]),t.pid!==e.pid?(this.removeNode(t),this.appendNode(e)):this.aNodes[this.getSelectedAi()]=e,$(this.config.treeFrameId).innerHTML=this.toString()},showOrder:function(e){if(this.config.showOrder){var t=$("orderDiv");t&&document.body.removeChild(t);var i=$.event(e).srcElement,n=$(i,!1),o=i.id.substring(this.obj.length+1),s=this.aNodes[o];if(-1!==s.pid){t=$("+div.orderDiv"),document.body.appendChild(t.s),t.class("pure-menu pure-order-menu"),t.css("position","absolute"),t.html('<span class="pure-menu-heading pure-menu-link pure-order-menu-heading" onclick="{0}.delete_click({1});{0}.clearFloatFrame();" >删除</span><ul class="pure-menu-list"><li class="pure-menu-item"><a href="#" class="pure-menu-link">当前第<span id="currentOrderNo"></span>位</a></li><li class="pure-menu-item pure-menu-has-children"><a  id="hyperJump" class="pure-menu-link">你可以跳转至</a> <ul id="ulChildrenList" class="pure-menu-children"></ul></li></ul>'.format(this.fullObjName,o)),t.bind("onclick",(function(e){$.event(e).cancelBubble()})),$("#hyperJump",!1).bind("onmouseover",(function(){$("#ulChildrenList",!1).css("display","block")})),t.css("left",n.getAbsoluteLeft()+i.offsetWidth+"px"),t.css("top",n.getAbsoluteTop()+i.offsetHeight+"px");for(var r=s._parentNode,a=0,l=0,c="",u=0;u<this.aNodes.length;u++)if(this.aNodes[u].pid===r.id)if(this.aNodes[u].id!==s.id){if(a++,c+='<li class="pure-menu-item" onclick="{0}.order({1},{2})"><a href="#" class="pure-menu-link">第<span>{2}</span>位</a></li>'.format(this.fullObjName,o,a),this.aNodes[u]._lastOfSameLevel)break}else l=++a;$("#ulChildrenList",!1).html(c),$("#currentOrderNo",!1).html(l)}else this.clearFloatFrame()}},order:function(e,t){var i=this.aNodes[e],n="id="+i.id+"&target="+t,o=this,s=this.aNodes;$.ajax.json(this.config.orderURL,n,(function(n){i=s[e];for(var r=i._parentNode,a=0,l=0,c=0;c<s.length;c++)if(s[c].pid===r.id&&(a++,a===t)){l=c,s[c];break}s.splice(e,1),s.splice(l,0,i),$("#"+o.config.treeFrameId).html(o),o.clearFloatFrame()}))},addNode:function(e){var t="",i=0;for(this.config.inOrder&&(i=e._addressIndex),i;i<this.aNodes.length;i++){var n=this.aNodes[i];if(n&&n.pid===e.id&&(n._parentNode=e,e.childCount++,n._addressIndex=i,this.setCS(n),!n.target&&this.config.target&&(n.target=this.config.target),n._hasChild&&!n._io&&this.config.useCookies&&(n._isOpened=this.isOpen(n.id)),!this.config.useFolderLinks&&n._hasChild&&(n.url=null),this.config.useSelection&&n.id===this.getSelectedId()&&(n._isSelected=!0,this.selectedNodeIndex=i,this.selectedFound=!0),this.config.showRootIco?t+=this.node(n,i):this.node(n,i),n._lastOfSameLevel))break}return t},select:function(e,t){null!=this.current&&(this.current.className=$(this.current).attr("old")),$(e).attr("old",e.className),e.className="iTreeNodeSelect"+t,this.current=e},node:function(e,t){var i="";this.config.treeNodeClass?i+=this.config.treeNodeClass:this.config.useTreeIdInNodeClass&&(i+=this.obj.substring(0,1).toUpperCase()+this.obj.substring(1)),this.config.useLevelInNodeClass&&(i+=this.aIndent.length>1?3:this.aIndent.length+1);var n='<div onclick="'+this.fullObjName+".select(this,'"+i+"');\"";return(this.config.useRootIcon||e.pid!==this.root.id)&&(n+=' class="iTreeNode'+i+'"'),n+='id="node'+this.obj+t+'"  >'+this.indent(e,t),this.config.useIcons&&(this.config.useLines?(e.icon=this.root.id===e.pid?this.icon.root:e._hasChild?this.icon.folder:this.icon.node,e.iconOpen=this.root.id===e.pid?this.icon.root:e._hasChild?this.icon.folderOpen:this.icon.node):e.icon||(e.iconOpen=e.icon=e._hasChild?this.icon.nolinefolder:this.icon.nolinenode),(this.config.useRootIcon||e.pid!==this.root.id)&&(n+="<img "+(this.config.showOrder?' onmouseover="'+this.fullObjName+'.showOrder(event)"':"")+' id="i'+this.obj+t+'" src="'+(e._isOpened?e.iconOpen:e.icon)+'" alt="" align="absMiddle"/>'),(e.showCtrl&&-1!==e.pid||-1===e.pid&&!0===this.userRootIcon)&&(this.config.useRadio&&(n+='<input style="line-height:15px;height:15px;border:0;" type="radio" name="iTreerdb" id="r{1}{0}" onclick="{1}.getRadioSelected({0});{1}.s({0});" value="{2}"/>'.format(t,this.fullObjName,e.id)),!0===this.config.useCheckbox&&(n+='<input style="line-height:15px;height:15px;border:0;" type="checkbox" name="iTreecbx" id="c{1}{0}" onclick="{1}.selectCheckbox({0});" value="{2}"/>'.format(t,this.fullObjName,e.id)))),e.url?(n+='<a ondblclick="javascript:'+this.fullObjName+".dbs("+t+');" id="s'+this.obj+t+'" class="'+(this.config.useSelection&&e._isSelected?"nodeSel":"node")+'" href="'+e.url+'"',e.title&&(n+=' title="'+e.title+'"'),e.target&&(n+=' target="'+e.target+'"'),this.config.useSelection&&(e._hasChild&&this.config.useFolderLinks||!e._hasChild)&&(n+=' onclick="javascript: '+this.fullObjName+".s("+t+");"),n+=(this.config.usePlusMinusIcons?"":e._hasChild&&-1!==e._parentNode.id?this.fullObjName+".o("+t+")":"")+'">'):this.config.useFolderLinks&&e.url||!e._hasChild||e.pid===this.root.id||(n+='<a href="javascript: '+this.fullObjName+".o("+t+');" class="node">'),n+='<span id="ntext'+this.obj+t+'">'+e.name+"</span>",!e.url&&(this.config.useFolderLinks&&e.url||!e._hasChild)||(n+="</a>"),n+="</div>",e._hasChild&&(n+='<div id="d'+this.obj+t+'" class="clip" style="display:'+(this.root.id===e.pid||e._isOpened?"block":"none")+';">',this.config.isdelay||this.config.isclientDelay?(e._isOpened&&-1!=e.pid||-1==e.pid)&&(n+=this.addNode(e)):n+=this.addNode(e),n+="</div>"),this.aIndent.pop(),n},indent:function(e,t){var i="";if(this.root.id===e.pid)return i;for(var n=0;n<this.aIndent.length;n++)i+='<img src="'+(1===this.aIndent[n]&&this.config.useLines?this.icon.line:this.icon.empty)+'" alt="" />';return e._lastOfSameLevel?this.aIndent.push(0):this.aIndent.push(1),this.config.usePlusMinusIcons?e._hasChild?(i+='<a href="javascript: '+this.fullObjName+".o("+t+');"><img id="j'+this.obj+t+'" src="',this.config.useLines?i+=e._isOpened?e._lastOfSameLevel&&this.config.useLines?this.icon.minusBottom:this.icon.minus:e._lastOfSameLevel&&this.config.useLines?this.icon.plusBottom:this.icon.plus:i+=e._isOpened?this.icon.nlMinus:this.icon.nlPlus,i+='"/></a>',i):(i+='<img id="j'+this.obj+t+'" src="'+(this.config.useLines?e._lastOfSameLevel?this.icon.joinBottom:this.icon.join:this.icon.empty)+'" alt="" />',i):(i+='<img style="width:0;height:0;" id="j'+this.obj+t+'"/>',i)},setCS:function(e){var t=null;e._hasChild=!1,e._lastOfSameLevel=!1;for(var i=0;i<this.aNodes.length;i++)!1===this.config.isdelay&&null!=this.aNodes[i]&&this.aNodes[i].pid==e.id&&(e._hasChild=!0),null!=this.aNodes[i]&&this.aNodes[i].pid==e.pid&&(t=this.aNodes[i].id);t===e.id&&(e._lastOfSameLevel=!0)},getAllNameOfNode:function(e,t){e||(e=this.aNodes[this.getSelectedAi()]);var i=[];while(-1!==e.id&&!$.isNullOrEmpty(e.name))-1!==e.name.indexOf(":")?i.push(e.name.split(":")[1]):i.push(e.name),e=e._parentNode?e._parentNode:this.aNodes[this.getAiById(e.pid)];return t=t||"  ",i.reverse(),i.join(t)},getSelectedAi:function(){return this.getAiById(this.getSelectedId())},getSelectedId:function(){var e;return e=!0===this.config.useCookies?this.getCookie("currentSelect"+this.obj):this.currentSelectId["currentSelect"+this.obj],e||null},clearSelectedNode:function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("cs"+this.obj,"cookieValue",t),this.currentSelectId["currentSelect"+this.obj]=null},setCurrentSelectNode:function(e){this.config.useCookies?this.setCookie("currentSelect"+this.obj,e.id):this.currentSelectId["currentSelect"+this.obj]=e.id},s:function(e){if(this.config.useSelection){var t=this.aNodes[e];if(!t._hasChild||this.config.useFolderLinks){if(this.selectedNodeIndex!==e&&((this.selectedNodeIndex||0===this.selectedNodeIndex)&&(eOld=document.getElementById("s"+this.obj+this.selectedNodeIndex),this.aNodes[this.selectedNodeIndex]._isSelected=!1,eOld&&(eOld.className="node")),eNew=document.getElementById("s"+this.obj+e),eNew.className="nodeSel",this.selectedNodeIndex=e,t._isSelected=!0,this.setCurrentSelectNode(t)),document.getElementById("r"+this.obj+e)&&(document.getElementById("r"+this.obj+e).checked=!0,this.getRadioSelected(e)),document.getElementById("c"+this.obj+e)){var i=document.getElementById("c"+this.obj+e);i.checked=!i.checked,this.selectCheckbox(e)}this.config.closeSameLevel&&this.closeLevel(t)}}},delayOpen:function(e){var t=this,i=e,n=e._addressIndex;if(i._isOpened)return!0;var o=document.getElementById("d"+this.obj+n);if(null!=o&&""==o.innerHTML){var s="ay=true&nodeId="+i.id;$("exceptid").value&&(s+="&exceptid="+$("exceptid").value),$.ajax.json(this.config.ajaxURL,s,(function(e){alert(e);var n=xmlHttpRequest.responseText.json();openNodeCallBack(n);var s=i,r=[];while(-1!=s.pid)r[r.length]=s._lastOfSameLevel?0:1,s=s._parentNode;for(var a=r.length-1;a>=0;a--)t.aIndent.push(r[a]);o.innerHTML=t.addNode(i);for(a=0;a<r.length;a++)t.aIndent.pop()}))}},clientDelayOpen:function(e,t){var i=e,n=e._addressIndex,o=0==i._isOpened||t;if(o){var s=document.getElementById("d"+this.obj+n);if(null!=s&&""==s.innerHTML||t){var r=i,a=[];while(r._parentNode.id!=this.root.id)a[a.length]=r._lastOfSameLevel?0:1,r=r._parentNode;for(var l=a.length-1;l>=0;l--)this.aIndent.push(a[l]);s.innerHTML=this.addNode(i);for(l=0;l<a.length;l++)this.aIndent.pop()}}},o:function(e){var t=this.aNodes[e];this.config.isdelay&&this.delayOpen(t),this.config.isclientDelay&&this.clientDelayOpen(t),this.nodeStatus(!t._isOpened,e,t._lastOfSameLevel),t._isOpened=!t._isOpened,this.config.closeSameLevel&&this.closeLevel(t),this.config.useCookies&&this.updateCookie()},oAll:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t]._hasChild&&this.aNodes[t].pid!=this.root.id&&(this.nodeStatus(e,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=e);this.config.useCookies&&this.updateCookie()},getAiById:function(e){for(var t=0;t<this.aNodes.length;t++)if(null!=this.aNodes[t]&&this.aNodes[t].id==e)return t;return null},openTo:function(e,t){if(t||(e=this.getAiById(e)),null!==e){var i=this.aNodes[e];if(this.config.delay){var n=[];while(-1!=i._parentNode.pid)n.push(i),i=i._parentNode}else i.pid!=this.root.id&&i._parentNode&&(i._isOpened=!0,this.completed&&i._hasChild&&this.nodeStatus(!0,i._addressIndex,i._lastOfSameLevel),this.openTo(i._parentNode._addressIndex,!0))}},closeLevel:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t].pid==e.pid&&this.aNodes[t].id!=e.id&&this.aNodes[t]._hasChild&&(this.nodeStatus(!1,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=!1,this.closeAllChildren(this.aNodes[t]))},closeAllChildren:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t].pid==e.id&&this.aNodes[t]._hasChild&&(this.aNodes[t]._isOpened&&this.nodeStatus(!1,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=!1,this.closeAllChildren(this.aNodes[t]))},nodeStatus:function(e,t,i){eDiv=document.getElementById("d"+this.obj+t),eJoin=document.getElementById("j"+this.obj+t),this.config.usePlusMinusIcons?(eIcon=document.getElementById("i"+this.obj+t),this.config.useIcons&&(eIcon.src=e?this.aNodes[t].iconOpen:this.aNodes[t].icon),eJoin.src=this.config.useLines?e?i?this.icon.minusBottom:this.icon.minus:i?this.icon.plusBottom:this.icon.plus:e?this.icon.nlMinus:this.icon.nlPlus):eJoin.src=this.icon.empty,eDiv.style.display=e?"block":"none"},clearCookie:function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("co"+this.obj,"cookieValue",t),this.setCookie("cs"+this.obj,"cookieValue",t)},setCookie:function(e,t,i,n,o,s){document.cookie=escape(e)+"="+escape(t)+(i?"; expires="+i.toGMTString():"")+(n?"; path="+n:"")+(o?"; domain="+o:"")+(s?"; secure":"")},getCookie:function(e){var t="",i=document.cookie.indexOf(escape(e)+"=");if(-1!=i){var n=i+(escape(e)+"=").length,o=document.cookie.indexOf(";",n);t=-1!=o?unescape(document.cookie.substring(n,o)):unescape(document.cookie.substring(n))}return t},updateCookie:function(){for(var e="",t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t]._isOpened&&this.aNodes[t].pid!=this.root.id&&(e&&(e+="."),e+=this.aNodes[t].id);this.setCookie("currentOpen"+this.obj,e)},isOpen:function(e){for(var t=this.getCookie("currentOpen"+this.obj).split("."),i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},getAllId:function(){for(var e=[],t=0;t<this.aNodes.length;t++)e.push(this.aNodes[t].id);return e},getAllParentNode:function(){var e=this.aNodes[this.getSelectedAi()],t=[];if(e)while(-1!=e.id)t.push(e.id),e=e._parentNode;else t.push(0);return t},selectChilds:function(e,t,i){pids=[];for(var n=0;n<i;n++)-1!=e.indexOf(this.aNodes[n].pid)&&0!=this.aNodes[n].showCtrl&&(document.getElementById("c"+this.obj+n).checked=t,pids.push(this.aNodes[n].id));0!=pids.length&&this.selectChilds(pids,t,i)},getRadioSelected:function(){return null},selectCheckbox:function(e){var t=this.aNodes[e],i=null;if(void 0==t.selectChild||1==t.selectChild){if(i=document.getElementById("c"+this.obj+e).checked,i){var n,o=t;while(-1!=o.id)n=document.getElementById("c"+this.obj+o._addressIndex),n&&(n.checked=!0),o=o._parentNode}for(var s=this.aNodes.length,r=[],a=0;a<s;a++)a!=e&&null!=this.aNodes[a]&&this.aNodes[a].pid==t.id&&0!=this.aNodes[a].showCtrl&&(document.getElementById("c"+this.obj+a).checked=i,r.push(this.aNodes[a].id));0!=r.length&&this.selectChilds(r,i,s)}this.checkBoxClick&&this.checkBoxClick(t.id,i)},setChecked:function(e){"string"==typeof e&&(e=e.split(","));for(var t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++){var n=parseInt(t[i].value,10);-1!==e.indexOf(n)&&(t[i].checked=!0)}},getAllCheckedTitle:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)!0===t[i].checked&&(arrayIndex=t[i].id.replace("c"+this.obj,""),e.push(this.aNodes[arrayIndex].title));return e},getAllChecked:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)!0===t[i].checked&&(arrayIndex=t[i].id.replace("c"+this.obj,""),e.push(this.aNodes[arrayIndex]));return e},getAllCheckedId:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)!0===t[i].checked&&e.push(t[i].value);return e.join()},show:function(e,t,i){if(!this.floatTreeFrameId){this.config.reBuildTree&&this.config.reBuildTree(),""==$(this.config.floatTreeId).innerHTML.trim()&&"undefined"!=typeof this.config.loadFloatTree&&this.config.loadFloatTree();var n=$.event(e).srcElement,o=$(n),s=document.createElement("DIV");s.id=this.config.floatTreeId+"Frame",s.style.cssText="position:absolute;width:"+t+"px;height:0px;border:#ccc 1px solid;background:#ffffff; padding:1px;text-align:left;overflow:auto;",s.innerHTML=this.config.loadingString,document.body.appendChild(s),s.onclick=function(e){$.event(e).cancelBubble()},s.style.left=o.getAbsoluteLeft()+1+"px",s.style.top=o.getAbsoluteTop()+n.offsetHeight+"px",this.interval=window.setInterval(this.fullObjName+".intervalShow("+i+")",10)}},intervalShow:function(e){var t=this.config.floatTreeId+"Frame",i=$(t).clientHeight+15;if(i>=e){if(this.floatTreeFrameId=t,$(this.config.floatTreeId)&&""!=$(this.config.floatTreeId).innerHTML){var n=$(this.config.floatTreeId);$(t).innerHTML="",n.style.display="block",$(t).appendChild(n),window.clearInterval(this.interval)}}else $(t).style.height=i+"px"},clearFloatFrame:function(){if(this.floatTreeFrameId){var e=$(this.floatTreeFrameId);if(!this.config.reBuildTree){var t=$(this.config.floatTreeId);t.style.display="none",document.body.appendChild(t)}document.body.removeChild(e),this.floatTreeFrameId=null,window.clearInterval(this.interval)}$("orderDiv")&&document.body.removeChild($("orderDiv"))},initResourceTree:function(e,t){t||(t=$.url.root+"/resource/load-all");var i=this;this.config.loadFloatTree=function(){$.ajax.json(t,e,(function(e){var t=e.data||e.message;i.aNodes=[],i.resetIcon(),i.config.usePlusMinusIcons=!1,i.config.useRootIcon=!1,i.add(t[0].parentId,-1,""),i.resetIcon();for(var n=0;n<t.length;n++)$.isNullOrEmpty(t[n].icoUrl)&&(t[n].icoUrl=$.DEFAULT_RESOURCE_ICO_URL),i.add(t[n].id,t[n].parentId,t[n].name,"javascript:"+i.fullObjName+".codeNodeClick("+(n+1)+");",t[n].name,void 0,void 0,void 0,t[n],t[n].icoUrl);$(i.config.floatTreeId).innerHTML=i}))}},initCodeTooltip:function(codePrefix,ajaxUrl){var htmlEvents="$('#'+{0}.config.descTextBoxId).bind('onchange',function(){if($({0}.config.descTextBoxId).value==''){$({0}.config.descHiddenId).value='';if(typeof({0}.config.valueTextBoxId)!='undefined'){$({0}.config.valueTextBoxId).value='';$({0}.config.valueTextBoxId).readOnly='readonly';}}});".format(this.fullObjName);eval(htmlEvents);var treeObject=this;if(null==$(treeObject.config.floatTreeId)){var floatTree=$("+div").s;floatTree.id=treeObject.config.floatTreeId,floatTree.className="floatTree",document.body.appendChild(floatTree)}ajaxUrl||(ajaxUrl=$.url.root+"/code/load"),this.dbs=function(e){var t=this.aNodes[e].businessEntity;if(null!=this.config.descHiddenId&&($(this.config.descHiddenId).value=t.id),null!=this.config.descTextBoxId){var i=$(this.config.descTextBoxId);"text"===i.type?i.value=this.getAllNameOfNode(this.aNodes[e],"/"):i.innerHTML=this.getAllNameOfNode(this.aNodes[e],"/")}null!=this.config.valueTextBoxId&&($(this.config.valueTextBoxId).value=t.value),this.codeNodeCallBack&&this.codeNodeCallBack(this.aNodes[e]),this.clearFloatFrame(),this.config.validate?this.config.validate():this.config.validateConfig&&$.v.isNull(this.config.validateConfig,i)},treeObject.config.loadFloatTree=function(){$.ajax.json(ajaxUrl,"prefix="+codePrefix,(function(e){var t=e.data||e.message;treeObject.aNodes=[],treeObject.resetIcon(),treeObject.config.usePlusMinusIcons=!1,treeObject.config.useRootIcon=!1,treeObject.add(t[0].parentId,-1,"");for(var i=0;i<t.length;i++)treeObject.add(t[i].id,t[i].parentId,t[i].name,"javascript:"+treeObject.fullObjName+".codeNodeClick("+(i+1)+");",t[i].code+"|"+t[i].name,void 0,void 0,void 0,t[i]);$(treeObject.config.floatTreeId).innerHTML=treeObject}))}},codeNodeClick:function(e){0===this.aNodes[e].childCount&&this.dbs(e)}},Sparrow.dispatcher={builder:{id:"id",delegate:"delegate",api:"api",strategy:"strategy",eventName:"eventName"},commandAdapter:{},ctrlIdEventMap:{},eventRegistry:[],register:function(e){this.eventRegistry.push(e)},dispatcher:function(e,t){var i=t.id+"_"+t.value,n=this.commandAdapter[i],o=null;null!=n&&(o=n.delegate),null==o&&(n=this.commandAdapter[t.id],null!=n&&(o=n.delegate)),null!=n&&null!=o&&(n.api?$.ajax.json(n.api,n.parameter,o,t):o(e,t))},bind:function(){for(var e=0;e<this.eventRegistry.length;e++){var t=this.eventRegistry[e],i=t.strategy,n=t.eventName,o=t.id+(i?"_"+i:"");this.commandAdapter[o]=t,this.ctrlIdEventMap[t.id]=n||"onclick"}for(ctrlId in this.ctrlIdEventMap)$("#"+ctrlId).bind(this.ctrlIdEventMap[ctrlId],(function(e){Sparrow.dispatcher.dispatcher(e,$.event(e).srcElement)}))}},Sparrow.user={authorMap:null,author:null,login:{dialog:function(e,t){var i=$.url.passport+"/login-dialog?register=false&callback-ns="+e;$.isNullOrEmpty(t)||(i+="&parameter="+t),document.domain=$.browser.cookie.root_domain,$.window({url:i,showHead:!1})},ns_callback:{publish:"thread.publish",attention:"user.attention",cancel_attention:"user.attention.cancel",comment:"thread.comment",upload:"upload",like_thread:"thread.like"}},getZone:function(e){return $.url.root+"/zone-"+e},getAvatar:function(e){return e||$.DEFAULT_AVATOR_URL},editable:function(e){var t=$.browser.getUserId();return!(t<=0)&&e===t},initLoginBar:function(){if($("divAccount")){if($.browser.isLogin()){$("divAccount").style.display="block",$("divLogin").style.display="none";var e=$("hyperUser");return $(e).html($.browser.getUserName()),e.title=$.browser.getUserName(),void(e.href=$.user.getZone($.browser.getUserId()))}$("divAccount").style.display="none",$("divLogin").style.display="block"}},popup:function(e,t){var i=null==this.authorMap?this.author:this.authorMap[t],n=$("divUserInfo");null==n&&(n=$("+div.divUserInfo"),n.s.style.cssText="border: #ccc 1px solid; position: absolute; width:300px; height:120px; background: #ffffff;overflow: hidden;",n.s.onmouseover=function(e){console.log("user info  mouse over ..."),$.event(e).cancelBubble()},document.body.appendChild(n.s)),$("divUserInfo").style.top=$(e).getAbsoluteTop()-2+"px",$("divUserInfo").style.left=$(e).getAbsoluteLeft()-2+"px";var o=[];o.push('<table style="border: 0;background:#fff;" cellpadding="0" cellspacing="0">'),o.push("<tr>"),o.push('<td style="border: 0; width:60px;" valign="top">'),o.push('<a href="{0}" target="_blank"><img style="width:50px; height: 50px; border: 2px #EDEDED solid;" src="{1}" /></a>'.format(this.getZone(i.id),this.getAvatar(i.avatar))),o.push("</td>"),o.push('<td style="border: 0; width: 240px; line-height: 25px;text-align:left;">'),o.push('昵称:<a href="{2}" target="_blank"><span>{0}</span></a>{1}<br />'.format(i.name,"attention",this.getZone(i.id))),o.push("性别:<span>{0}</span><br />".format(i.gender)),i.createTime&&o.push("注册日期:<span>{0}</span><br />".format(i.createTime)),i.lastLoginTime&&o.push("最后登陆:<span>{0}</span><br />".format(i.lastLoginTime)),$.isNullOrEmpty(i.status)||o.push("状态：<span>{0}</span><br />".format(i.status)),$("divUserInfo").innerHTML=o.join(""),$("#divUserInfo").show(),document.onmouseover=function(e){$("#divUserInfo").hidden()}},json:function(e){var t=$(e);return null!=t&&(e=t.value.json()),e},initAuthor:function(e){this.author=this.json(e)},initAuthorMap:function(e){this.authorMap=this.json(e)},attention:function(){return!1},getToken:function(){var e=Sparrow.request("token");return Sparrow.isNullOrEmpty(e)?localStorage.getItem("token"):(localStorage.setItem("token",e),e)}},Sparrow.share={config:{icon:$.url.resource+"/images/share.png",share:[{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?style=202&width=80&height=31&showcount=1&url={0}&title={1}&pics={2}&desc={3}&summary={4}&site="+encodeURIComponent($.browser.getCookie($.browser.cookie.website_name))+"&otype=share",position:{left:160,top:0},title:"分享到QQ空间"},{url:"http://service.weibo.com/share/share.php?appkey=318168823&url={0}&title={1}&pic={2}&ralateUid=3199233727",position:{left:0,top:0},title:"分享到新浪微博"}]},init:function(){for(var e=document.getElementsByName("share"),t=[],i=0;i<this.config.share.length;i++)t.push('<a target="_blank" style="height:32px;width:32px;display:inline-block;background:url({0}) {1}px {2}px;" title="{3}" href="{4}"></a>'.format(this.config.icon,this.config.share[i].position.left,this.config.share[i].position.top,this.config.share[i].title,this.config.share[i].url));shareTemplate=t.join("");for(var n=e.length-1;n>=0;n--){var o=e[n].value.json();e[n].parentNode.innerHTML=shareTemplate.format(encodeURIComponent(o.url),encodeURIComponent(o.title),encodeURIComponent(o.pic),encodeURIComponent(o.comment),encodeURIComponent(o.summary))}}},Sparrow.webSocket=function(e,t){this.url=e,this.token=t,this.onMsgCallback=null,this.heartTime=1e4,this.heartTimeout=2e4,this.reconnectTime=500,this.timeoutTimer=null,this.serverTimeoutTimer=null,this.ws=null,this.lastHeartTime=0,this.reconnectionAlarmTimer=null,this.reconnectionAlarmCallback=null,this.userId=null},Sparrow.webSocket.prototype.connect=function(t,i){try{"WebSocket"in window&&(this.ws=new WebSocket(this.url,[this.token]),this._onOpen(),this._onMsg(t,i),this._onClose(i),this._onError(i))}catch(e){console.log(e),this.reconnectWebSocket()}},Sparrow.webSocket.prototype.close=function(){this.ws.close()},Sparrow.webSocket.prototype.reconnectWebSocket=function(){new Date-this.lastHeartTime>2*this.heartTimeout?(console.log("发起重连"),this.reconnectionAlarmTimer=setInterval((()=>{this.reconnectionAlarmCallback&&this.reconnectionAlarmCallback(),console.log("连接断开，请刷新浏览器！")}),1e4),this.closeHeartBeat()):console.log("服务器顶替逻辑，不重连!")},Sparrow.webSocket.prototype._onOpen=function(){this.ws.onopen=e=>{console.log(e.currentTarget.protocol),console.log("连接成功"+e),this.closeHeartBeat(),this.startHeartBeat()}},Sparrow.webSocket.prototype._onMsg=function(e){this.ws.onmessage=t=>{if(console.log("收到消息"+t.data),"string"===typeof t.data){if("PONG"===t.data)return void(this.lastHeartTime=(new Date).getTime());if("offline"===t.data)return this.lastHeartTime=(new Date).getTime(),void(this.onMsgCallback&&this.onMsgCallback({offline:!0}));var i=t.data.indexOf("USER.");if(i>-1)return this.userInfo=t.data.substring(5),void e(this.userInfo)}this.onMsgCallback(t.data)}},Sparrow.webSocket.prototype._onClose=function(e){this.ws.onclose=t=>{console.log("close 事件"),t.wasClean?console.log("不重连"):this.reconnectWebSocket(),e(t)}},Sparrow.webSocket.prototype._onError=function(e){this.onerror=t=>{console.log("连接出错"+t),this.reconnectWebSocket(),e(t)}},Sparrow.webSocket.prototype.startHeartBeat=function(){this.timeoutTimer=setInterval((()=>{try{this.ws.send("PING")}catch(e){console.log("heart beat error:"+e)}console.log("heart beat: "+(new Date).getSeconds()+" timer id:"+this.timeoutTimer)}),this.heartTime),this.serverTimeoutTimer=setInterval((()=>{(new Date).getTime()-this.lastHeartTime>2*this.heartTime&&this.reconnectWebSocket()}),this.heartTimeout)},Sparrow.webSocket.prototype.closeHeartBeat=function(){clearTimeout(this.timeoutTimer),clearTimeout(this.serverTimeoutTimer)},Sparrow.webSocket.prototype.sendMessage=function(e){this.ws.send(e.toBytes())}},4804:function(t,i,n){n.d(i,{W:function(){return c}});n(7658);var o=n(9727),s=n(6225);console.log({NODE_ENV:"production",BASE_URL:"/"});const r={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_SPARROW_BASE_URL,a={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_CONSUMER_BASE_URL;console.log(a),console.log(r);var l={};l[r]={"login-token":function(){return localStorage.getItem("token")}},l[a]={"X-Sugar-Token":function(){return localStorage.getItem("token")}},o.h.ajax.tokenConfig=l;const c={getSession:function(){return o.h.http.post(r+"/sessions")},getUserId:async function(){return await o.h.http.post(r+"/get-user-id").then((e=>e.data),(e=>{console.log(e)}))},getContacts:async function(){return await o.h.http.post(r+"/contacts")},setRead:function(e,t){const i={sessionKey:e.key};return o.h.http.post(r+"/session/read",i).then((i=>(0==i.code&&(e.lastReadTime=new Date,s.u.assembleLastMessage(e),s.u.resortSessions(t)),i.data)),(e=>{console.log(e)}))},cancelMsg:async function(e){return await o.h.http.post(r+"/cancel",e).then((e=>e.data),(e=>{console.log(e)}))},login:function(e,t,i){const n={code:e,mobile:t,password:i,areaCode:""};return o.h.http.post(a+"/app/authMember/loginByCode",n)},getUserByPhone:function(e){const t="mobile="+e;return o.h.http.get(a+"/app/message/userDetail?"+t)},getUserById:async function(e,t){if(null!=t&&null!=t[e])return t[e];const i="id="+e;return await o.h.http.get(a+"/app/message/findById?"+i).then((function(e){return e.data}))},getUserMapByIds:async function(t,i){if(!Array.isArray(t)||0===t.length)return{};var n=-1,s=0;try{var r={},l=[];for(s=0;s<t.length;s++)n=t[s],null!=i[n]?r[n]=i[n]:l.push(n);if(0===l.length)return r;const e=await o.h.http.post(a+"/app/message/userDetailList",l).then((function(e){return e.data}),(function(e){return{error:e}}));if(null==e||0===e.length)return r;for(s=0;s<e.length;s++){n=e[s].id;var c=e[s];c.platform=!!c.isCustomer,i[n]=e[s],r[n]=e[s]}return r}catch(e){return console.error(e),{}}},addFriendById:function(e){const t="id="+e;return o.h.http.post(a+"/app/message/addFriend",t)},removeFriend:function(e){const t="id="+e;return o.h.http.post(a+"/app/message/removeFriend",t)},newFriendList:function(e){const t="id="+e;return o.h.http.get(a+"/app/message/newFriend?"+t)},auditFriend:function(e,t){const i="id="+e+"&status="+t;return o.h.http.post(a+"/app/message/userFriendAudit",i)},existGroup:function(e){const t="groupId="+e;return o.h.http.post(a+"/app/message/quitGroup",t)},modifyGroup:function(e,t,i){const n="groupId="+e+"&name="+t+"&avatar="+i;return o.h.http.post(a+"/app/message/changeGroup",n)},systemNotice:function(){return o.h.http.get(a+"/app/message/systemInform")},platformServices:function(){return o.h.http.get(a+"/app/message/customList")}}},6225:function(e,t,i){i.d(t,{u:function(){return s}});i(7658);var n=i(4804),o=i(4087),s={initPlatformService:async function(e){var t=await n.W.platformServices();200===t.code&&(e.prototype.$platformServers=t.rows,t.rows.forEach((t=>{t.platform=!0,e.prototype.$userMap[t.userId]=t}))),console.log("res",t)},initContact:async function(e,t){var i=await n.W.getContacts();e.prototype.$contact=i.data,console.log("res",i);var o={};i.data.users.forEach((e=>{o[e.userId]=e})),e.prototype.$userMap=o;var s={};i.data.quns.forEach((e=>{s[e.qunId]=e})),e.prototype.$qunMap=s,console.log("userMap",o)},_oppositeUser:function(e,t){return o.x.getOppositeUser(e.chatSession.sessionKey,t.$getUserId())},fetchUserIds:function(e){var t=[];return e.forEach((e=>{t.indexOf(e.chatSession.sender)<0&&t.push(e.chatSession.sender),e.chatSession.receiver>0&&t.indexOf(e.chatSession.receiver)<0&&t.push(e.chatSession.receiver),e.messages.forEach((e=>{t.indexOf(e.sender)<0&&t.push(e.sender)}))})),t},assembleSessions:function(e,t,i){var n=[];return e.forEach((e=>{var o=e.chatSession;const s=o.chatType,r=o.sessionKey;var a=null;if(s===i.$protocol.CHAT_TYPE_1_2_1){var l=this._oppositeUser(e,i),c=t[l];if(!c)return null;a={key:r,type:s,icon:c.avatar,lastReadTime:e.lastReadTime,flag:c.flagUrl,title:c.userName,oppositeUserId:c.userId,messages:e.messages}}if(s===i.$protocol.CHAT_TYPE_1_2_N){var u=i.$qunMap[r];a={key:r,type:s,title:u.qunName,messages:e.messages,icon:u.unitIcon,lastReadTime:e.lastReadTime}}this.assembleLastMessage(a,i),n.push(a)})),n},resortSessions:function(e){e.$sessions=e.$sessions.sort((function(e,t){return t.lastReadTime===e.lastReadTime?0:t.lastReadTime>e.lastReadTime?1:-1}))},initActiveSession:function(e){var t=e.$getUserId(),i=e.$route.query.key;if(null!=i){if(i.indexOf("_")){var n=e.$protocol.getOppositeUser(i,t),o=e.$userMap[n];this.get121Session(o,e)}else{var s=e.$qunMap[i];this.getQunSession(s,e)}e.activeSession=e.$sessionMap[i]}else e.activeSession=e.sessionList[0]},rebuild:function(e,t){var i=t.$userMap[e.sender],n=null;if(e.msgType===t.$protocol.IMAGE_MESSAGE){var s=new Blob([e.msg]);n=window.URL.createObjectURL(s)}var r={id:e.clientSendTime,chatType:e.chatType,sender:e.sender,clientSendTime:e.clientSendTime,messageType:e.msgType,content:e.msg,imgUrl:n,isMe:e.sender===t.$getUserId(),userName:i.userName,avatar:i.avatar,time:new Date(e.clientSendTime).format("MM/dd hh:mm:ss"),isText:e.msgType===t.$protocol.TEXT_MESSAGE,session:e.chatType===t.$protocol.CHAT_TYPE_1_2_N?e.sessionKey:o.x.generate121SessionKey(e.sender,e.receiver)},a=t.$sessionMap[r.session];a.messages.push(r),this.assembleLastMessage(a,t)},get121Session:function(e,t){var i=t.$getUserId(),n=t.$protocol.generate121SessionKey(e.userId,i),s=t.$sessionMap[n];return null!=s?n:(s={platform:!!e.platform,key:n,type:o.x.CHAT_TYPE_1_2_1,icon:e.avatar,flag:e.flagUrl,title:e.userName,messages:[],oppositeUserId:e.userId,lastReadTime:0},t.$sessions.push(s),t.$sessionMap[s.key]=s,s.key)},getQunSession:function(e,t){var i=e.id,n=t.$sessionMap[i];return null!=n?i:(n={key:i,type:o.x.CHAT_TYPE_1_2_N,icon:e.avatar,title:e.title,messages:[],lastReadTime:0},t.$sessions.push(n),t.$sessionMap[n.key]=n,n.key)},assembleLastMessage(e,t){if(null==e.messages||0===e.messages.length)return;var i=null,n=null,o=null;i=e.messages[e.messages.length-1],n=i.clientSendTime,o=1===i.messageType?"/图片/":i.content;const s=e.messages.filter((t=>t.serverTime>=e.lastReadTime)).length;e.lastMessageTime=n,e.time=new Date(n).format("MM/dd hh:mm:ss"),e.lastMessageContent=o,e.unReadCount=s},initSessions:async function(e,t){var i=await n.W.getSession().then((e=>e.data),(e=>{console.log(e)})),o=this.fetchUserIds(i);const s=await n.W.getUserMapByIds(o,t.$userMap);var r=this.assembleSessions(i,s,t);r.forEach((e=>{e.messages.forEach((e=>{e.isMe=e.sender===t.$getUserId();var i=s[e.sender];e.userName=i.userName,e.avatar=i.avatar,e.time=new Date(e.serverTime).format("MM/dd hh:mm:ss"),e.isText=e.messageType===t.$protocol.TEXT_MESSAGE,e.isText||(e.imgUrl=e.content)}))}));var a={};r.forEach((e=>{a[e.key]=e})),e.prototype.$sessions=r,this.resortSessions(t),e.prototype.$sessionMap=a},initWebSocket:async function(e,t){return await new Promise(((i,n)=>{var r=new t.$sparrow.webSocket("ws://chat.sparrowzoo.com/websocket",t.$token);r.reconnectionAlarmCallback=function(){console.log("reconnection AlarmCallback")},r.onMsgCallback=function(e){e.offline?console.log("消息已发送，对方不在线，稍后会收到消息"):o.x.parse(e,(function(e){s.rebuild(e,t),console.log("parse protocol:"+e)}))},r.connect(i,n),e.prototype.$webSocket=r})).then((e=>{var i=e.split(",");if(2!==i.length)throw new Error("用户信息错误");t.$webSocket.userId=parseInt(i[0],10),t.$webSocket.platform="true"===i[1]}))}}},8647:function(t,i,n){n.a(t,(async function(t,i){try{var o=n(7195),s=n(4040),r=n(3306),a=n(1115),l=n(5114),c=n.n(l),u=n(9727),d=n(4087),h=n(6225);o["default"].config.productionTip=!1,o["default"].use(c());const e=new o["default"]({router:s.Z,store:r.Z,render:e=>e(a.Z)});o["default"].prototype.$sparrow=u.h,o["default"].prototype.$protocol=d.x,o["default"].prototype.$getUserId=function(){return null!=this.$webSocket&&null!=this.$webSocket.userId?this.$webSocket.userId:(console.log("兜底获取用户id"),null)},o["default"].prototype.$init=async function(){o["default"].prototype.$token=u.h.user.getToken(),await h.u.initWebSocket(o["default"],e),await h.u.initContact(o["default"],e),e.$webSocket.platform||await h.u.initPlatformService(o["default"]),await h.u.initSessions(o["default"],e)},window.location.href.indexOf("/login")<0&&await e.$init(),e.$mount("#app"),i()}catch(e){i(e)}}),1)},4040:function(e,t,i){var n=i(7195),o=i(2241);const s=()=>i.e(822).then(i.bind(i,7822)),r=()=>i.e(106).then(i.bind(i,7106)),a=()=>i.e(928).then(i.bind(i,928)),l=()=>i.e(419).then(i.bind(i,3419)),c=()=>i.e(228).then(i.bind(i,228)),u=()=>i.e(799).then(i.bind(i,1799)),d=()=>i.e(193).then(i.bind(i,6193)),h=()=>i.e(240).then(i.bind(i,7240)),p=()=>i.e(868).then(i.bind(i,7868));n["default"].use(o.ZP);const f=o.ZP.prototype.push;o.ZP.prototype.push=function(e){return f.call(this,e).catch((e=>e))};const g=new o.ZP({base:"/",routes:[{path:"/login",name:"login",component:s},{path:"/",name:"main",component:r,children:[{path:"/contact",name:"contact-menu",component:a,children:[{path:"/",name:"contact",component:l},{path:"new",name:"new-friend",component:c},{path:"qun",name:"qun",component:u}]},{path:"session",name:"session",component:h},{path:"notice",name:"notice",component:p},{path:"platform-service",name:"platform-service",component:d}]}]});t["Z"]=g},3306:function(e,t,i){var n=i(408),o=i(7195);o["default"].use(n.ZP),t["Z"]=new n.ZP.Store({state(){return{menuId:1}},mutations:{activeMenu(e,t){e.menuId=t}}})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.m=__webpack_modules__,function(){__webpack_require__.amdO={}}(),function(){var e="function"===typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"===typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"===typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=function(e){e&&!e.d&&(e.d=1,e.forEach((function(e){e.r--})),e.forEach((function(e){e.r--?e.r++:e()})))},o=function(o){return o.map((function(o){if(null!==o&&"object"===typeof o){if(o[e])return o;if(o.then){var s=[];s.d=0,o.then((function(e){r[t]=e,n(s)}),(function(e){r[i]=e,n(s)}));var r={};return r[e]=function(e){e(s)},r}}var a={};return a[e]=function(){},a[t]=o,a}))};__webpack_require__.a=function(s,r,a){var l;a&&((l=[]).d=1);var c,u,d,h=new Set,p=s.exports,f=new Promise((function(e,t){d=t,u=e}));f[t]=p,f[e]=function(e){l&&e(l),h.forEach(e),f["catch"]((function(){}))},s.exports=f,r((function(n){var s;c=o(n);var r=function(){return c.map((function(e){if(e[i])throw e[i];return e[t]}))},a=new Promise((function(t){s=function(){t(r)},s.r=0;var i=function(e){e!==l&&!h.has(e)&&(h.add(e),e&&!e.d&&(s.r++,e.push(s)))};c.map((function(t){t[e](i)}))}));return s.r?a:r()}),(function(e){e?d(f[i]=e):u(p),n(l)})),l&&(l.d=0)}}(),function(){var e=[];__webpack_require__.O=function(t,i,n,o){if(!i){var s=1/0;for(c=0;c<e.length;c++){i=e[c][0],n=e[c][1],o=e[c][2];for(var r=!0,a=0;a<i.length;a++)(!1&o||s>=o)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](i[a])}))?i.splice(a--,1):(r=!1,o<s&&(s=o));if(r){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,n,o]}}(),function(){__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,{a:t}),t}}(),function(){__webpack_require__.d=function(e,t){for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){__webpack_require__.f={},__webpack_require__.e=function(e){return Promise.all(Object.keys(__webpack_require__.f).reduce((function(t,i){return __webpack_require__.f[i](e,t),t}),[]))}}(),function(){__webpack_require__.u=function(e){return"static/js/"+e+"."+{106:"7a09f30c",193:"ddd5aff4",228:"55bc932b",240:"af4ec684",419:"83cf416a",799:"669eefa0",822:"f350cd38",868:"d579dce5",928:"f6e599b7"}[e]+".js"}}(),function(){__webpack_require__.miniCssF=function(e){return"static/css/"+e+"."+{106:"27e7fd58",193:"b245a5f1",228:"7bfd0373",240:"619c74cd",419:"b245a5f1",799:"56cbbf68",822:"4f48f42c",868:"072c3838",928:"21336f54"}[e]+".css"}}(),function(){__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="chat-pc:";__webpack_require__.l=function(i,n,o,s){if(e[i])e[i].push(n);else{var r,a;if(void 0!==o)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==t+o){r=u;break}}r||(a=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,__webpack_require__.nc&&r.setAttribute("nonce",__webpack_require__.nc),r.setAttribute("data-webpack",t+o),r.src=i),e[i]=[n];var d=function(t,n){r.onerror=r.onload=null,clearTimeout(h);var o=e[i];if(delete e[i],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((function(e){return e(n)})),t)return t(n)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=d.bind(null,r.onerror),r.onload=d.bind(null,r.onload),a&&document.head.appendChild(r)}}}(),function(){__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){__webpack_require__.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){__webpack_require__.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,i,n,o){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css";var r=function(i){if(s.onerror=s.onload=null,"load"===i.type)n();else{var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=r,l.request=a,s.parentNode&&s.parentNode.removeChild(s),o(l)}};return s.onerror=s.onload=r,s.href=t,i?i.parentNode.insertBefore(s,i.nextSibling):document.head.appendChild(s),s},t=function(e,t){for(var i=document.getElementsByTagName("link"),n=0;n<i.length;n++){var o=i[n],s=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(s===e||s===t))return o}var r=document.getElementsByTagName("style");for(n=0;n<r.length;n++){o=r[n],s=o.getAttribute("data-href");if(s===e||s===t)return o}},i=function(i){return new Promise((function(n,o){var s=__webpack_require__.miniCssF(i),r=__webpack_require__.p+s;if(t(s,r))return n();e(i,r,null,n,o)}))},n={143:0};__webpack_require__.f.miniCss=function(e,t){var o={106:1,193:1,228:1,240:1,419:1,799:1,822:1,868:1,928:1};n[e]?t.push(n[e]):0!==n[e]&&o[e]&&t.push(n[e]=i(e).then((function(){n[e]=0}),(function(t){throw delete n[e],t})))}}}(),function(){var e={143:0};__webpack_require__.f.j=function(t,i){var n=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var o=new Promise((function(i,o){n=e[t]=[i,o]}));i.push(n[2]=o);var s=__webpack_require__.p+__webpack_require__.u(t),r=new Error,a=function(i){if(__webpack_require__.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var o=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",r.name="ChunkLoadError",r.type=o,r.request=s,n[1](r)}};__webpack_require__.l(s,a,"chunk-"+t,t)}},__webpack_require__.O.j=function(t){return 0===e[t]};var t=function(t,i){var n,o,s=i[0],r=i[1],a=i[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(n in r)__webpack_require__.o(r,n)&&(__webpack_require__.m[n]=r[n]);if(a)var c=a(__webpack_require__)}for(t&&t(i);l<s.length;l++)o=s[l],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return __webpack_require__.O(c)},i=self["webpackChunkchat_pc"]=self["webpackChunkchat_pc"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var __webpack_exports__=__webpack_require__.O(void 0,[998],(function(){return __webpack_require__(8647)}));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();
//# sourceMappingURL=app.345393c8.js.map