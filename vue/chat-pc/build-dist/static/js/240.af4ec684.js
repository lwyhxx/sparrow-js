"use strict";(self["webpackChunkchat_pc"]=self["webpackChunkchat_pc"]||[]).push([[240],{7240:function(s,t,e){e.r(t),e.d(t,{default:function(){return M}});var a=function(){var s=this,t=s._self._c;return t("div",{staticClass:"chat"},[t("div",{staticClass:"msg-part"},[s._m(0),t("div",{staticClass:"msg-list"},s._l(s.sessionList,(function(e){return t("div",{key:e.key,staticClass:"msg-item",class:e.key===s.activeSession.key?"session-active":"",on:{click:function(t){return s.switchSession(e)}}},[t("div",{staticClass:"avatar"},[t("img",{staticClass:"avatar-img",attrs:{src:e.icon,alt:"用户头像"}}),e.type===s.$protocol.CHAT_TYPE_1_2_1?t("img",{staticClass:"nation",attrs:{src:e.flag,alt:"国籍"}}):s._e(),e.unReadCount>0?t("span",{staticClass:"unread"},[s._v(s._s(e.unReadCount))]):s._e()]),t("div",{staticClass:"msg-user-time"},[t("div",{staticClass:"msg-user"},[t("span",{staticClass:"user-name"},[s._v(s._s(e.title))]),t("span",{staticClass:"msg-time"},[s._v(s._s(e.time))])]),t("span",{staticClass:"msg-last"},[s._v(s._s(e.lastMessageContent))])])])})),0)]),t("div",{staticClass:"msg-content"},[t("ChatPart",{attrs:{session:s.activeSession}})],1)])},i=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"search-part"},[t("div",{staticClass:"search-icon"},[t("i",{staticClass:"iconfont icon-search"})]),t("div",{staticClass:"search-add iconfont icon-add-user"})])}],n=function(){var s=this,t=s._self._c;return t("div",{},[t("div",{staticClass:"msg-recall",staticStyle:{display:"none"}},[s._v("撤回")]),t("div",{staticClass:"msg-content"},[t("div",{staticClass:"title"},[t("span",{staticClass:"user"},[s._v(s._s(s.session.title)+" "+s._s(s.session.platform?"[平台]":""))]),t("i",{directives:[{name:"show",rawName:"v-show",value:s.session.type===s.$protocol.CHAT_TYPE_1_2_N,expression:"session.type === $protocol.CHAT_TYPE_1_2_N"}],staticClass:"iconfont icon-more show-more-icon",on:{click:s.showMore}})]),t("div",{staticClass:"msg-detail"},[s._l(s.session.messages,(function(e){return[t("div",{key:e.id},["recall"===e.messageType?t("div",[e.isMe?t("div",{staticClass:"show-recall-mime recall"},[s._m(0,!0)]):t("div",{staticClass:"show-recall-other recall"},[t("p",[t("span",{staticClass:"recall-user"},[s._v(s._s(s.session.title))]),s._v("撤回了一条消息 ")])])]):t("div",[(e.isMe,t("ChatItem",{attrs:{"message-item":e}}))],1)])]}))],2),t("div",{staticClass:"input-part"},[t("div",{staticClass:"conver-button"},[t("span",[s._v("英")]),t("span",{staticClass:"active-lang"},[s._v("中")]),t("div",{staticClass:"upload-part"},[s._m(1),t("input",{staticClass:"upload-img",staticStyle:{display:"none"},attrs:{id:"upload",type:"file"},on:{change:function(t){return s.sendImage(t.target.files[0])}}})])]),t("div",{staticClass:"input-message"},[t("div",{staticClass:"text"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:s.content,expression:"content"}],staticClass:"input-content",domProps:{value:s.content},on:{input:function(t){t.target.composing||(s.content=t.target.value)}}})]),t("button",{staticClass:"send-btn",on:{click:s.sendText}},[s._v("发送")])])]),t("MoreDetail",{ref:"showMore"})],1)])},o=[function(){var s=this,t=s._self._c;return t("p",[s._v("你撤回了一条消息"),t("span",{staticClass:"reset"},[s._v(" 重新编辑")])])},function(){var s=this,t=s._self._c;return t("label",{attrs:{for:"upload"}},[t("i",{staticClass:"iconfont icon-img"})])}],l=(e(3767),e(8585),e(8696),function(){var s=this,t=s._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:s.showDetailFlag,expression:"showDetailFlag"}],ref:"detail-ref",staticClass:"more-message"},[s._m(0)])}),c=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"group-more-part"},[t("div",{staticClass:"more-search"},[t("i",{staticClass:"iconfont icon-sousuo"}),t("input",{staticClass:"search-member",attrs:{placeholder:"搜索",type:"text"}})]),t("div",{staticClass:"group-more-content"},[t("div",{staticClass:"user-list"},[t("div",{staticClass:"more-user"},[t("img",{attrs:{alt:"",src:"https://img1.imgtp.com/2023/01/29/odnUWlDQ.jpg"}}),t("span",[s._v("用名")])]),t("div",{staticClass:"more-icon"},[t("div",{staticClass:"search-add"},[s._v("+")]),t("span",[s._v("添加")])])]),t("div",{staticClass:"look-more-user"},[t("span",[s._v("查看更多")]),t("i",{staticClass:"iconfont icon-down-more"})]),t("div",{staticClass:"more-common"},[t("p",[s._v("群聊名称")]),t("span",{staticClass:"qun-name"}),t("p",[s._v("群公告")]),t("span",{staticClass:"qun-announcement"})])])])}],r={destroyed(){console.log("销毁")},data(){return{showDetailFlag:!1}},methods:{showDetail(){this.showDetailFlag=!0,this.detailRegister()},detailRegister(){this.$refs["detail-ref"].addEventListener("click",this.showFn),this.windowRegister()},showFn(s){s.stopPropagation()},windowRegister(){window.addEventListener("click",this.closeDetail)},closeDetail(){this.showDetailFlag=!1,window.removeEventListener("click",this.closeDetail),this.$refs["detail-ref"].removeEventListener("click",this.closeDetail)}}},m=r,d=e(1001),u=(0,d.Z)(m,l,c,!1,null,"c5d4edcc",null),v=u.exports,p=function(){var s=this,t=s._self._c;return t("div",{staticClass:"message",class:s.messageItem.isMe?"right":"left"},[s.messageItem.time?t("div",{staticClass:"time"},[s._v(" "+s._s(s.messageItem.time)+" ")]):s._e(),t("div",{staticClass:"user-msg"},[t("img",{staticClass:"avatar-user",attrs:{src:s.messageItem.avatar,alt:""}}),s.messageItem.isText?t("div",{staticClass:"message-detail",on:{contextmenu:function(t){return s.rightClick(s.messageItem,t)}}},[t("div",{staticClass:"user-name"},[s._v(s._s(s.messageItem.userName))]),t("span",{staticClass:"block"}),t("span",{staticClass:"message-text"},[s._v(s._s(s.messageItem.content))])]):t("div",{staticClass:"msg-picture-detail",on:{contextmenu:s.rightClick}},[t("div",{staticClass:"user-name"},[s._v(s._s(s.messageItem.userName))]),t("img",{staticClass:"msg-picture",attrs:{src:s.messageItem.imgUrl,alt:""}})])])])},h=[],g={props:{messageItem:{type:Object,require:!0}},methods:{rightClick(s,t){console.log(s),t.preventDefault();var e=this.$sparrow.event(t);let a=document.querySelector(".msg-recall");a.style.display="block",a.style.top=e.getAbsoluteTop()+"px",a.style.left=e.getAbsoluteLeft()+"px",a.style.zIndex=1e3}},data(){return{menus:[{name:"菜单四",operType:4,icon:"el-icon-folder-remove"}]}}},C=g,_=(0,d.Z)(C,p,h,!1,null,"474de8ef",null),f=_.exports,w=e(4087),y=e(6225),k={components:{MoreDetail:v,ChatItem:f},props:{session:{type:Object,default:()=>{}}},mounted(){console.log("session:"+JSON.stringify(this.session))},data(){return{content:""}},methods:{showMore(s){s.stopPropagation(),this.$refs["showMore"].showDetail()},async sendImage(s){const t=new FileReader;var e=this;t.onload=function(){const s=t.result;console.log(s);var a=new Uint8Array(s),i=(new Date).getTime(),n=parseInt(e.$route.query.chatType,10),o=new e.$protocol(n,e.$protocol.IMAGE_MESSAGE,e.$getUserId(),e.session.oppositeUserId,e.session.key,a,i);e.$webSocket.sendMessage(o),this.content="",y.u.rebuild(o,e),y.u.resortSessions(e)},t.readAsArrayBuffer(s),this.handleScrollBottom()},sendText(){if(this.content){var s=(new Date).getTime(),t=parseInt(this.session.type,10),e=new w.x(t,w.x.TEXT_MESSAGE,this.$getUserId(),this.session.oppositeUserId,this.session.key,this.content,s);this.$webSocket.sendMessage(e),this.content="",y.u.rebuild(e,this),y.u.resortSessions(this),console.log("parse protocol:"+e)}else this.$message("嘿！你还没有输入内容哦！")}}},I=k,S=(0,d.Z)(I,n,o,!1,null,"fa13a560",null),x=S.exports,b=e(4804),D={components:{ChatPart:x},data(){return{sessionList:this.$sessions,activeSession:{key:-1}}},computed:{},mounted(){this.$store.commit("activeMenu",2),y.u.initActiveSession(this),b.W.setRead(this.activeSession,this)},methods:{switchSession(s){this.activeSession=s,b.W.setRead(this.activeSession,this)}}},T=D,$=(0,d.Z)(T,a,i,!1,null,"0801cdf0",null),M=$.exports}}]);
//# sourceMappingURL=240.af4ec684.js.map